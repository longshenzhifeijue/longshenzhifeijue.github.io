

<!DOCTYPE html>
<html lang="en" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>SpringCloud - Hexo</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="SpingCloud



微服务微服务是一种架构模式...">
  <meta name="author" content="Xu Fei">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: false,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '真正的大师，永远怀着一颗学徒的心',
          typing: false,
          api: '',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">SpringCloud</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 摄影</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/longshenzhifeijue">XuFei</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img src="/images/theme/post-image.jpg" draggable="false">
  <div class="head-mask">
    <h1 class="head-title">SpringCloud</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>October 24, 2020</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>13354</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h2 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h2><p>微服务是一种架构模式,SpringCloud是全家桶,是微服务和分布式技术的集大成者<br><img  src="http://xmt.ssluxury.cn/image-20201007144946875.png"  ><span class="image-caption">image-20201007144946875</span></p>
<h2 id="SpringBoot和SrpingCloud版本选型"><a href="#SpringBoot和SrpingCloud版本选型" class="headerlink" title="SpringBoot和SrpingCloud版本选型"></a>SpringBoot和SrpingCloud版本选型</h2><p>由于SpringBoot和SpringCloud版本存在依赖和约束,需要严格按照官网选择对应版本</p>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927222120701.png"  ><span class="image-caption">image-20200927222120701</span></p>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p><img  src="http://xmt.ssluxury.cn/image-20200927222312987.png"  ><span class="image-caption">image-20200927222312987</span></p>
<h2 id="Cloud组件停更-升级-替换"><a href="#Cloud组件停更-升级-替换" class="headerlink" title="Cloud组件停更/升级/替换"></a>Cloud组件停更/升级/替换</h2><p><img  src="http://xmt.ssluxury.cn/image-20200927223425823.png"  ><span class="image-caption">image-20200927223425823</span></p>
<h2 id="第一个组件-服务注册中心"><a href="#第一个组件-服务注册中心" class="headerlink" title="第一个组件:服务注册中心"></a>第一个组件:服务注册中心</h2><p><code>Eureka</code></p>
<p>为什么需要服务注册中心?类似医院有个门诊,知道了这个专家提供多少医疗服务,多少病人今天挂号了,统一调度协调和管理</p>
<h3 id="什么是服务治理"><a href="#什么是服务治理" class="headerlink" title="什么是服务治理?"></a>什么是服务治理?</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927224001260.png"  ><span class="image-caption">image-20200927224001260</span></p>
<h3 id="什么是服务注册"><a href="#什么是服务注册" class="headerlink" title="什么是服务注册?"></a>什么是服务注册?</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927224033950.png"  ><span class="image-caption">image-20200927224033950</span><br><img  src="http://xmt.ssluxury.cn/image-20200927224046881.png"  ><span class="image-caption">image-20200927224046881</span></p>
<h3 id="Euraka的两个组件"><a href="#Euraka的两个组件" class="headerlink" title="Euraka的两个组件"></a>Euraka的两个组件</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927224433607.png"  ><span class="image-caption">image-20200927224433607</span></p>
<h3 id="Eureka集群原理"><a href="#Eureka集群原理" class="headerlink" title="Eureka集群原理"></a>Eureka集群原理</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927224731606.png"  ><span class="image-caption">image-20200927224731606</span><br><img  src="http://xmt.ssluxury.cn/image-20200927224837164.png"  ><span class="image-caption">image-20200927224837164</span><br>互相注册,相互守望<br><img  src="http://xmt.ssluxury.cn/image-20200927224923516.png"  ><span class="image-caption">image-20200927224923516</span></p>
<h3 id="Eureka自我保护机制"><a href="#Eureka自我保护机制" class="headerlink" title="Eureka自我保护机制"></a>Eureka自我保护机制</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927230130563.png"  ><span class="image-caption">image-20200927230130563</span><br><img  src="http://xmt.ssluxury.cn/image-20200927225730210.png"  ><span class="image-caption">image-20200927225730210</span><br>导致原因<br><img  src="http://xmt.ssluxury.cn/image-20200927225809305.png"  ><span class="image-caption">image-20200927225809305</span><br><img  src="http://xmt.ssluxury.cn/image-20200927225952472.png"  ><span class="image-caption">image-20200927225952472</span><br><img  src="http://xmt.ssluxury.cn/image-20200927230035517.png"  ><span class="image-caption">image-20200927230035517</span><br><img  src="http://xmt.ssluxury.cn/image-20200927230058691.png"  ><span class="image-caption">image-20200927230058691</span><br>关闭自我保护<br><img  src="http://xmt.ssluxury.cn/image-20200927230344619.png"  ><span class="image-caption">image-20200927230344619</span></p>
<h3 id="几种注册中心不同点"><a href="#几种注册中心不同点" class="headerlink" title="几种注册中心不同点"></a>几种注册中心不同点</h3><p><img  src="http://xmt.ssluxury.cn/image-20200927231014812.png"  ><span class="image-caption">image-20200927231014812</span><br><img  src="http://xmt.ssluxury.cn/image-20200927230938257.png"  ><span class="image-caption">image-20200927230938257</span><br><img  src="http://xmt.ssluxury.cn/image-20200927231117152.png"  ><span class="image-caption">image-20200927231117152</span><br><img  src="http://xmt.ssluxury.cn/image-20200927231146827.png"  ><span class="image-caption">image-20200927231146827</span></p>
<h2 id="第二个组件-服务调用"><a href="#第二个组件-服务调用" class="headerlink" title="第二个组件:服务调用"></a>第二个组件:服务调用</h2><p><code>Ribbon负载均衡</code><br><img  src="http://xmt.ssluxury.cn/image-20200929175710715.png"  ><span class="image-caption">image-20200929175710715</span></p>
<h3 id="LB负载均衡"><a href="#LB负载均衡" class="headerlink" title="LB负载均衡"></a>LB负载均衡</h3><p>Nginx好比医院大门负载均衡,Ribbon好比某个科室排班负载均衡<br><img  src="http://xmt.ssluxury.cn/image-20200929180121076.png"  ><span class="image-caption">image-20200929180121076</span><br><img  src="http://xmt.ssluxury.cn/image-20200929180413349.png"  ><span class="image-caption">image-20200929180413349</span><br><img  src="http://xmt.ssluxury.cn/image-20200929180435315.png"  ><span class="image-caption">image-20200929180435315</span></p>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p><img  src="http://xmt.ssluxury.cn/image-20200929181236430.png"  ><span class="image-caption">image-20200929181236430</span></p>
<h3 id="IRule-根据特定算法从服务列表中获取一个要访问的服务"><a href="#IRule-根据特定算法从服务列表中获取一个要访问的服务" class="headerlink" title="IRule:根据特定算法从服务列表中获取一个要访问的服务"></a>IRule:根据特定算法从服务列表中获取一个要访问的服务</h3><p><img  src="http://xmt.ssluxury.cn/image-20200930145305576.png"  ><span class="image-caption">image-20200930145305576</span><br><img  src="http://xmt.ssluxury.cn/image-20200930145452916.png"  ><span class="image-caption">image-20200930145452916</span><br>如何替换?自己自定义手写一个?<br><img  src="http://xmt.ssluxury.cn/image-20200930145659097.png"  ><span class="image-caption">image-20200930145659097</span><br>配置细节:<br><img  src="http://xmt.ssluxury.cn/image-20200930144419009.png"  ><span class="image-caption">image-20200930144419009</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@RibbonClient(name = &quot;CLOUD-PROVIDER-SERVICE&quot;,configuration = MySelfRule.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderMain80</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(OrderMain80.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img  src="http://xmt.ssluxury.cn/image-20200930152840477.png"  ><span class="image-caption">image-20200930152840477</span></p>
<h2 id="Ribbon负载均衡算法的原理"><a href="#Ribbon负载均衡算法的原理" class="headerlink" title="Ribbon负载均衡算法的原理"></a>Ribbon负载均衡算法的原理</h2><p><img  src="http://xmt.ssluxury.cn/image-20200930154448126.png"  ><span class="image-caption">image-20200930154448126</span></p>
<h2 id="RoundRobinRule源码分析"><a href="#RoundRobinRule源码分析" class="headerlink" title="RoundRobinRule源码分析"></a>RoundRobinRule源码分析</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoundRobinRule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractLoadBalancerRule</span> </span>&#123;<br><br> <span class="hljs-function"><span class="hljs-keyword">public</span> Server <span class="hljs-title">choose</span><span class="hljs-params">(ILoadBalancer lb, Object key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (lb == <span class="hljs-keyword">null</span>) &#123;<br>            log.warn(<span class="hljs-string">&quot;no load balancer&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        Server server = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (server == <span class="hljs-keyword">null</span> &amp;&amp; count++ &lt; <span class="hljs-number">10</span>) &#123;<br>            <span class="hljs-comment">// 获取所有up机器节点,也就是活着的节点数量</span><br>            List&lt;Server&gt; reachableServers = lb.getReachableServers();<br>            List&lt;Server&gt; allServers = lb.getAllServers();<br>            <span class="hljs-keyword">int</span> upCount = reachableServers.size();<br>            <span class="hljs-keyword">int</span> serverCount = allServers.size();<br><br>            <span class="hljs-keyword">if</span> ((upCount == <span class="hljs-number">0</span>) || (serverCount == <span class="hljs-number">0</span>)) &#123;<br>                log.warn(<span class="hljs-string">&quot;No up servers available from load balancer: &quot;</span> + lb);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// </span><br>            <span class="hljs-keyword">int</span> nextServerIndex = incrementAndGetModulo(serverCount);<br>            server = allServers.get(nextServerIndex);<br><br>            <span class="hljs-keyword">if</span> (server == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">/* Transient. */</span><br>                Thread.yield();<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;<br>                <span class="hljs-keyword">return</span> (server);<br>            &#125;<br><br>            <span class="hljs-comment">// Next.</span><br>            server = <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (count &gt;= <span class="hljs-number">10</span>) &#123;<br>            log.warn(<span class="hljs-string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span><br>                    + lb);<br>        &#125;<br>        <span class="hljs-keyword">return</span> server;<br>    <br>&#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">incrementAndGetModulo</span><span class="hljs-params">(<span class="hljs-keyword">int</span> modulo)</span> </span>&#123;<br>        <span class="hljs-comment">// 不是一个死循环,这里叫自旋锁,原子类</span><br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">int</span> current = nextServerCyclicCounter.get();<br>            <span class="hljs-keyword">int</span> next = (current + <span class="hljs-number">1</span>) % modulo;<br>            <span class="hljs-keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next))<br>                <span class="hljs-keyword">return</span> next;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="手写一个负载均衡算法"><a href="#手写一个负载均衡算法" class="headerlink" title="手写一个负载均衡算法"></a>手写一个负载均衡算法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟 ILoadBalancer 的接口，选择哪一个负载算法和机器</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wsk</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2020/3/13 17:11</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">LoadBalancer</span> </span>&#123;<br>    <span class="hljs-comment">//获取eureka上的活着的机器总数</span><br>    <span class="hljs-function">ServiceInstance <span class="hljs-title">instances</span><span class="hljs-params">(List&lt;ServiceInstance&gt; serviceInstanceList)</span></span>;<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ribbon 手写轮询算法</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wsk</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2020/3/13 17:16</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLB</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">LoadBalancer</span> </span>&#123;<br>    <span class="hljs-comment">//原子类</span><br>    <span class="hljs-keyword">private</span> AtomicInteger atomicInteger = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAndIncrement</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">int</span> current;<br>        <span class="hljs-keyword">int</span> next;<br>        <span class="hljs-keyword">do</span>&#123;<br>            current = <span class="hljs-keyword">this</span>.atomicInteger.get();<br>            <span class="hljs-comment">//超过最大值，为0，重新计数 2147483647 Integer.MAX_VALUE，不直接写方法是因为方法运行时每次都会创建一个栈区，而写死就不会，涉及Jvm调优</span><br>            next = current &gt;= <span class="hljs-number">2147483647</span> ? <span class="hljs-number">0</span> : current + <span class="hljs-number">1</span>;<br>            <span class="hljs-comment">//自旋锁(比如current为0,this跟0比较是true更为expect;否则不操作)</span><br>        &#125;<span class="hljs-keyword">while</span> (!<span class="hljs-keyword">this</span>.atomicInteger.compareAndSet(current,next));<br>        System.out.println(<span class="hljs-string">&quot;*****第几次访问，次数next：&quot;</span>+next);<br>        <span class="hljs-keyword">return</span> next;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServiceInstance <span class="hljs-title">instances</span><span class="hljs-params">(List&lt;ServiceInstance&gt; serviceInstance)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> index = getAndIncrement() % serviceInstance.size();<br>        <span class="hljs-keyword">return</span> serviceInstance.get(index);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1):<br>@RibbonClient(name = “CLOUD-PROVIDER-SERVICE”,configuration = RoundRobinRule.class)<br>@RibbonClient(name = “CLOUD-PROVIDER-SERVICE”,configuration = MySelfRule.class)<br>2):@LoadBalanced 负载均衡要起效需要加上,如果自定义则删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">ApplicationContextConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span>   <span class="hljs-comment">//使用@LoadBalanced注解赋予RestTemplate负载均衡的能力</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">getRestTemplate</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="第三个组件-服务调用"><a href="#第三个组件-服务调用" class="headerlink" title="第三个组件:服务调用"></a>第三个组件:服务调用</h2><p><code>OpenFeign</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">openFeign是SpringCloud在Feign的基础上做了一些加强,其实是一回事,用在消费者,客户端,主要做服务的调用,一句话,Feign就是参考Ribbon的基础做了一套父接口+注解方式调用的整合器;Feign是一个声明式的Web服务客户端,让编写Web服务客户端变得非常容易,只需要创建一个接口并在接口上添加注解即可<br></code></pre></td></tr></table></figure>

<p><img  src="http://xmt.ssluxury.cn/image-20200930162835968.png"  ><span class="image-caption">image-20200930162835968</span></p>
<h3 id="能干嘛"><a href="#能干嘛" class="headerlink" title="能干嘛"></a>能干嘛</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">接口服务方统一暴露接口,接口调用方也存在对应接口,形成接口-&gt;接口,服务接口绑定器<br></code></pre></td></tr></table></figure>
<p><img  src="http://xmt.ssluxury.cn/image-20200930163642492.png"  ><span class="image-caption">image-20200930163642492</span></p>
<h3 id="Feign和OpenFeign区别"><a href="#Feign和OpenFeign区别" class="headerlink" title="Feign和OpenFeign区别"></a>Feign和OpenFeign区别</h3><p><img  src="http://xmt.ssluxury.cn/image-20200930164159114.png"  ><span class="image-caption">image-20200930164159114</span></p>
<h3 id="OpenFeign的超时控制"><a href="#OpenFeign的超时控制" class="headerlink" title="OpenFeign的超时控制"></a>OpenFeign的超时控制</h3><p>问题:接口服务方需要3秒,而调用方只愿意等2秒,则超时,那么需要在调用方配置文件中配置超时时间<br><img  src="http://xmt.ssluxury.cn/image-20200930165547129.png"  ><span class="image-caption">image-20200930165547129</span><br><img  src="http://xmt.ssluxury.cn/image-20200930165709082.png"  ><span class="image-caption">image-20200930165709082</span><br>OpenFeign支持Ribbon,可以在配置文件中这么配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#设置feign 客户端超时时间（openFeign默认支持ribbon）</span><br><span class="hljs-attr">ribbon:</span><br><span class="hljs-comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下，两端连接所用的时间</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">5000</span><br><span class="hljs-comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">5000</span><br><br></code></pre></td></tr></table></figure>
<h3 id="OpenFeign的日志打印"><a href="#OpenFeign的日志打印" class="headerlink" title="OpenFeign的日志打印"></a>OpenFeign的日志打印</h3><p>1)配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeignConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    Logger.<span class="hljs-function">Level <span class="hljs-title">feignLoggerLevel</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> Logger.Level.FULL;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>2)、配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-comment">#feign日志以什么级别监控哪个接口</span><br>    <span class="hljs-attr">com.atguigu.springcloud.service.PaymentFeignService:</span> <span class="hljs-string">debug</span><br><br></code></pre></td></tr></table></figure>
<h2 id="第四个组件-服务降级-服务熔断、限制限流、服务隔离"><a href="#第四个组件-服务降级-服务熔断、限制限流、服务隔离" class="headerlink" title="第四个组件:服务降级(服务熔断、限制限流、服务隔离)"></a>第四个组件:服务降级(服务熔断、限制限流、服务隔离)</h2><p><code>Hystrix</code></p>
<h3 id="分布式系统面临的问题"><a href="#分布式系统面临的问题" class="headerlink" title="分布式系统面临的问题:"></a>分布式系统面临的问题:</h3><p><img  src="http://xmt.ssluxury.cn/image-20200930173123597.png"  ><span class="image-caption">image-20200930173123597</span><br><img  src="http://xmt.ssluxury.cn/image-20200930173259054.png"  ><span class="image-caption">image-20200930173259054</span></p>
<h3 id="Hystrix是什么"><a href="#Hystrix是什么" class="headerlink" title="Hystrix是什么"></a>Hystrix是什么</h3><p><img  src="http://xmt.ssluxury.cn/image-20200930173325661.png"  ><span class="image-caption">image-20200930173325661</span></p>
<h3 id="Hystrix重要概念"><a href="#Hystrix重要概念" class="headerlink" title="Hystrix重要概念"></a>Hystrix重要概念</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1</span>)服务降级<br>    服务器忙，请稍候再试，不让客户端等待并立刻返回一个友好提示，fallback<br>    哪些情况会触发降级:<br>        <span class="hljs-number">1</span>)程序运行异常<br>        <span class="hljs-number">2</span>)超时<br>        <span class="hljs-number">3</span>)服务熔断触发服务降级<br>        <span class="hljs-number">4</span>)线程池/信号量打满也会导致服务降级<br><span class="hljs-number">2</span>)服务熔断<br>    类比保险丝达到最大服务访问后，直接拒绝访问，拉闸限电，然后调用服务降级的方法并返回友好提示<br>    就是保险丝(服务的降级-&gt;进而熔断-&gt;恢复调用链路)<br><br><span class="hljs-number">3</span>)服务限流<br>    秒杀高并发等操作，严禁一窝蜂的过来拥挤，大家排队，一秒钟N个，有序进行<br><br></code></pre></td></tr></table></figure>
<h3 id="服务熔断机制"><a href="#服务熔断机制" class="headerlink" title="服务熔断机制"></a>服务熔断机制</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007144735216.png"  ><span class="image-caption">image-20201007144735216</span></p>
<h3 id="服务熔断原理"><a href="#服务熔断原理" class="headerlink" title="服务熔断原理"></a>服务熔断原理</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007145238918.png"  ><span class="image-caption">image-20201007145238918</span></p>
<h3 id="服务熔断配置参数"><a href="#服务熔断配置参数" class="headerlink" title="服务熔断配置参数"></a>服务熔断配置参数</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007150638219.png"  ><span class="image-caption">image-20201007150638219</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//服务熔断</span><br>   <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">           @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),   //是否开启断路器</span><br><span class="hljs-meta">           @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),  //请求次数</span><br><span class="hljs-meta">           @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;),    //时间窗口期</span><br><span class="hljs-meta">           @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),    //失败率达到多少后跳闸</span><br><span class="hljs-meta">   &#125;)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">paymentCircuitBreaker</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;<br>       <span class="hljs-keyword">if</span>(id &lt; <span class="hljs-number">0</span>)&#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;******id 不能为负数&quot;</span>);<br>       &#125;<br>       String serialNumber = IdUtil.simpleUUID();  <span class="hljs-comment">//UUID.randomUUID();</span><br><br>       <span class="hljs-keyword">return</span> Thread.currentThread().getName()+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot;调用成功，流水号：&quot;</span>+serialNumber;<br>   &#125;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">paymentCircuitBreaker_fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;id 不能负数，请稍后再试，o(╥﹏╥)o  id：&quot;</span>+id;<br>   &#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="HystrixCommandProperties记录所有默认配置属性"><a href="#HystrixCommandProperties记录所有默认配置属性" class="headerlink" title="HystrixCommandProperties记录所有默认配置属性"></a>HystrixCommandProperties记录所有默认配置属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HystrixCommandProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(HystrixCommandProperties.class);<br><br>    <span class="hljs-comment">/* defaults */</span><br>    <span class="hljs-comment">/* package */</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsRollingStatisticalWindow = <span class="hljs-number">10000</span>;<span class="hljs-comment">// default =&gt; statisticalWindow: 10000 = 10 seconds (and default of 10 buckets so each bucket is 1 second)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsRollingStatisticalWindowBuckets = <span class="hljs-number">10</span>;<span class="hljs-comment">// default =&gt; statisticalWindowBuckets: 10 = 10 buckets in a 10 second window so each bucket is 1 second</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_circuitBreakerRequestVolumeThreshold = <span class="hljs-number">20</span>;<span class="hljs-comment">// default =&gt; statisticalWindowVolumeThreshold: 20 requests in 10 seconds must occur before statistics matter</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_circuitBreakerSleepWindowInMilliseconds = <span class="hljs-number">5000</span>;<span class="hljs-comment">// default =&gt; sleepWindow: 5000 = 5 seconds that we will sleep before trying again after tripping the circuit</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_circuitBreakerErrorThresholdPercentage = <span class="hljs-number">50</span>;<span class="hljs-comment">// default =&gt; errorThresholdPercentage = 50 = if 50%+ of requests in 10 seconds are failures or latent then we will trip the circuit</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_circuitBreakerForceOpen = <span class="hljs-keyword">false</span>;<span class="hljs-comment">// default =&gt; forceCircuitOpen = false (we want to allow traffic)</span><br>    <span class="hljs-comment">/* package */</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_circuitBreakerForceClosed = <span class="hljs-keyword">false</span>;<span class="hljs-comment">// default =&gt; ignoreErrors = false </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_executionTimeoutInMilliseconds = <span class="hljs-number">1000</span>; <span class="hljs-comment">// default =&gt; executionTimeoutInMilliseconds: 1000 = 1 second</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_executionTimeoutEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ExecutionIsolationStrategy default_executionIsolationStrategy = ExecutionIsolationStrategy.THREAD;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_executionIsolationThreadInterruptOnTimeout = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_executionIsolationThreadInterruptOnFutureCancel = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_metricsRollingPercentileEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_requestCacheEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_fallbackIsolationSemaphoreMaxConcurrentRequests = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_fallbackEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_executionIsolationSemaphoreMaxConcurrentRequests = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_requestLogEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean default_circuitBreakerEnabled = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsRollingPercentileWindow = <span class="hljs-number">60000</span>; <span class="hljs-comment">// default to 1 minute for RollingPercentile </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsRollingPercentileWindowBuckets = <span class="hljs-number">6</span>; <span class="hljs-comment">// default to 6 buckets (10 seconds each in 60 second window)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsRollingPercentileBucketSize = <span class="hljs-number">100</span>; <span class="hljs-comment">// default to 100 values max per bucket</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer default_metricsHealthSnapshotIntervalInMilliseconds = <span class="hljs-number">500</span>; <span class="hljs-comment">// default to 500ms as max frequency between allowing snapshots of health (error percentage etc)</span><br><br><br></code></pre></td></tr></table></figure>
<h3 id="服务熔断总结"><a href="#服务熔断总结" class="headerlink" title="服务熔断总结"></a>服务熔断总结</h3><p><a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/wiki/How-it-Works">Hystrix</a><br><code>熔断类型</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151330659.png"  ><span class="image-caption">image-20201007151330659</span><br><code>官网断路器流程</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151457848.png"  ><span class="image-caption">image-20201007151457848</span><br><code>断路器在什么情况下起作用</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151531624.png"  ><span class="image-caption">image-20201007151531624</span><br><code>断路器开启或关闭的条件</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151707706.png"  ><span class="image-caption">image-20201007151707706</span><br><code>断路器打开之后</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151739890.png"  ><span class="image-caption">image-20201007151739890</span><br><code>All配置</code><br><img  src="http://xmt.ssluxury.cn/image-20201007151843858.png"  ><span class="image-caption">image-20201007151843858</span></p>
<h3 id="工作流程图"><a href="#工作流程图" class="headerlink" title="工作流程图"></a>工作流程图</h3><p><img  src="http://xmt.ssluxury.cn/hystrix-command-flow-chart.png"  ><span class="image-caption">hystrix-command-flow-chart</span></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p><img  src="http://xmt.ssluxury.cn/image-20201007153723523.png"  ><span class="image-caption">image-20201007153723523</span><br><img  src="http://xmt.ssluxury.cn/image-20201007154036281.png"  ><span class="image-caption">image-20201007154036281</span></p>
<h3 id="SpringCloud升级后监控服务留下的坑"><a href="#SpringCloud升级后监控服务留下的坑" class="headerlink" title="SpringCloud升级后监控服务留下的坑"></a>SpringCloud升级后监控服务留下的坑</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007154325454.png"  ><span class="image-caption">image-20201007154325454</span></p>
<h3 id="如何看"><a href="#如何看" class="headerlink" title="如何看"></a>如何看</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007155020373.png"  ><span class="image-caption">image-20201007155020373</span><br><code>七色</code><br>七种颜色<br><code>一圆</code><br><img  src="http://xmt.ssluxury.cn/image-20201007155059421.png"  ><span class="image-caption">image-20201007155059421</span><br><code>一线</code><br><img  src="http://xmt.ssluxury.cn/image-20201007155308342.png"  ><span class="image-caption">image-20201007155308342</span><br><code>整图说明</code><br><img  src="http://xmt.ssluxury.cn/image-20201007155332188.png"  ><span class="image-caption">image-20201007155332188</span></p>
<h2 id="第五个组件-Gateway网关"><a href="#第五个组件-Gateway网关" class="headerlink" title="第五个组件:Gateway网关"></a>第五个组件:Gateway网关</h2><p>Gateway是一种理念,有两种技术:一是Netflix的Zuul,另一个就是SpringCloud的Gateway,推荐选用后者<br><img  src="http://xmt.ssluxury.cn/image-20201007160032379.png"  ><span class="image-caption">image-20201007160032379</span></p>
<h3 id="SpringCloudGateway"><a href="#SpringCloudGateway" class="headerlink" title="SpringCloudGateway"></a>SpringCloudGateway</h3><p>SpringCloudGateway使用的Webflux中的reactor-netty响应式编程组件,底层采用Netty通讯框架<br><img  src="http://xmt.ssluxury.cn/image-20201007160225081.png"  ><span class="image-caption">image-20201007160225081</span></p>
<h3 id="底层框架认证"><a href="#底层框架认证" class="headerlink" title="底层框架认证"></a>底层框架认证</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007160854492.png"  ><span class="image-caption">image-20201007160854492</span></p>
<h3 id="微服务架构中网关在哪里"><a href="#微服务架构中网关在哪里" class="headerlink" title="微服务架构中网关在哪里"></a>微服务架构中网关在哪里</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007161004284.png"  ><span class="image-caption">image-20201007161004284</span></p>
<h3 id="有了zuul为什么还选择Gateway"><a href="#有了zuul为什么还选择Gateway" class="headerlink" title="有了zuul为什么还选择Gateway?"></a>有了zuul为什么还选择Gateway?</h3><p>1)<br><img  src="http://xmt.ssluxury.cn/image-20201007161137355.png"  ><span class="image-caption">image-20201007161137355</span><br>2)<br><img  src="http://xmt.ssluxury.cn/image-20201007161526061.png"  ><span class="image-caption">image-20201007161526061</span><br>3)<br><img  src="http://xmt.ssluxury.cn/image-20201007161700034.png"  ><span class="image-caption">image-20201007161700034</span></p>
<h3 id="zuul模型"><a href="#zuul模型" class="headerlink" title="zuul模型"></a>zuul模型</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007161739592.png"  ><span class="image-caption">image-20201007161739592</span><br><img  src="http://xmt.ssluxury.cn/image-20201007161845721.png"  ><span class="image-caption">image-20201007161845721</span></p>
<h3 id="gateWay"><a href="#gateWay" class="headerlink" title="gateWay"></a>gateWay</h3><p><img  src="http://xmt.ssluxury.cn/image-20201007161929930.png"  ><span class="image-caption">image-20201007161929930</span></p>
<h3 id="三大核心概念"><a href="#三大核心概念" class="headerlink" title="三大核心概念"></a>三大核心概念</h3><p><code>Route(路由)</code><br>路由是构建网关的基本模块，它由ID，目标URI，一系列的断言和过滤器组成，如果断言为true则匹配该路由<br><code>Predicate（断言）</code><br>参考的是java8的java.util.function.Predicate开发人员可以匹配HTTP请求中的所有内容（例如请求头或请求参数），如果请求与断言相匹配则进行路由<br><code>Filter(过滤)</code><br>指的是Spring框架中GatewayFilter的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。<br><code>总体</code><br><img  src="http://xmt.ssluxury.cn/image-20201007220134924.png"  ><span class="image-caption">image-20201007220134924</span></p>
<h3 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><p><code>自定义全局GlobalFilter</code><br>1)两个主要接口介绍<br>impiemerts   GlobalFilter ，Ordered<br>2)<br>全局日志记录、统一网关鉴权</p>
<h2 id="第六个组件-Config服务配置"><a href="#第六个组件-Config服务配置" class="headerlink" title="第六个组件:Config服务配置"></a>第六个组件:Config服务配置</h2><p>1)分布式系统面临的配置问题,<br>2)集中管理配置文件,不同环境不同配置，动态化的配置更新，<br>3)分环境部署比如dev/test/prod/beta/release<br>4)运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息<br>5)当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的配置<br>6)将配置信息以REST接口的形式暴露(post、curl访问刷新均可….)</p>
<h2 id="第七个组件-Naocs服务注册和配置中心"><a href="#第七个组件-Naocs服务注册和配置中心" class="headerlink" title="第七个组件:Naocs服务注册和配置中心"></a>第七个组件:Naocs服务注册和配置中心</h2><p><code>定义</code><br>一个更易于构建云原生应用的动态服务发现，配置管理和服务管理中心,Nacos就是注册中心+配置中心的组合,Nacos = Eureka+Config+Bus<br>``</p>
<h3 id="服务注册中心的对比"><a href="#服务注册中心的对比" class="headerlink" title="服务注册中心的对比"></a>服务注册中心的对比</h3><p><img  src="http://xmt.ssluxury.cn/image-20201009140232654.png"  ><span class="image-caption">image-20201009140232654</span></p>
<h3 id="Nacos和CAP"><a href="#Nacos和CAP" class="headerlink" title="Nacos和CAP"></a>Nacos和CAP</h3><p><img  src="http://xmt.ssluxury.cn/image-20201009140626080.png"  ><span class="image-caption">image-20201009140626080</span></p>
<h3 id="Nacos支持AP和CP模式的切换"><a href="#Nacos支持AP和CP模式的切换" class="headerlink" title="Nacos支持AP和CP模式的切换"></a>Nacos支持AP和CP模式的切换</h3><p><img  src="http://xmt.ssluxury.cn/image-20201009140727464.png"  ><span class="image-caption">image-20201009140727464</span></p>
<h2 id="第个八组件-Sentinel熔断与限流"><a href="#第个八组件-Sentinel熔断与限流" class="headerlink" title="第个八组件:Sentinel熔断与限流"></a>第个八组件:Sentinel熔断与限流</h2><p><code>分布式系统的流量防卫兵</code>,就是豪猪哥的阿里版本</p>
<h2 id="Sentinel-是什么？"><a href="#Sentinel-是什么？" class="headerlink" title="Sentinel 是什么？"></a>Sentinel 是什么？</h2><p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p>
<p>Sentinel 具有以下特征:</p>
<ul>
<li><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</li>
<li><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</li>
<li><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</li>
<li><strong>完善的 SPI 扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</li>
</ul>
<p>Sentinel 的主要特性：</p>
<p><img  src="http://xmt.ssluxury.cn/50505538-2c484880-0aaf-11e9-9ffc-cbaaef20be2b.png"  ><span class="image-caption">Sentinel-features-overview</span></p>
<p>Sentinel 的开源生态：</p>
<p><img  src="http://xmt.ssluxury.cn/84338449-a9497e00-abce-11ea-8c6a-473fe477b9a1.png"  ><span class="image-caption">Sentinel-opensource-eco</span></p>
<p>Sentinel 分为两个部分:</p>
<ul>
<li>核心库（Java 客户端）不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</li>
<li>控制台（Dashboard）基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</li>
</ul>
<h3 id="Hystrix-VS-Sentinel"><a href="#Hystrix-VS-Sentinel" class="headerlink" title="Hystrix VS Sentinel"></a>Hystrix VS Sentinel</h3><p><img  src="http://xmt.ssluxury.cn/image-20201009141738310.png"  ><span class="image-caption">image-20201009141738310</span></p>
      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>Xu Fei</li>
    <li><strong>本文链接：</strong><a href="https://longshenzhifeijue.github.io/2020/10/24/02spring/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1/index.html" title="https:&#x2F;&#x2F;longshenzhifeijue.github.io&#x2F;2020&#x2F;10&#x2F;24&#x2F;02spring&#x2F;SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1&#x2F;index.html">https:&#x2F;&#x2F;longshenzhifeijue.github.io&#x2F;2020&#x2F;10&#x2F;24&#x2F;02spring&#x2F;SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img src="https://pic.izhaoo.com/alipay.jpg">
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li></ul> 

        
  <nav class="nav">
    <a href="/2020/11/07/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"><i class="iconfont iconleft"></i>数据结构与算法</a>
    <a href="/2020/10/22/RabbitMQ%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/">RabbitMQ消息中间间<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">微服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%92%8CSrpingCloud%E7%89%88%E6%9C%AC%E9%80%89%E5%9E%8B"><span class="toc-text">SpringBoot和SrpingCloud版本选型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-text">方法一</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-text">方法二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cloud%E7%BB%84%E4%BB%B6%E5%81%9C%E6%9B%B4-%E5%8D%87%E7%BA%A7-%E6%9B%BF%E6%8D%A2"><span class="toc-text">Cloud组件停更&#x2F;升级&#x2F;替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">第一个组件:服务注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86"><span class="toc-text">什么是服务治理?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="toc-text">什么是服务注册?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Euraka%E7%9A%84%E4%B8%A4%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="toc-text">Euraka的两个组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Eureka%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86"><span class="toc-text">Eureka集群原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Eureka%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6"><span class="toc-text">Eureka自我保护机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E7%A7%8D%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%B8%8D%E5%90%8C%E7%82%B9"><span class="toc-text">几种注册中心不同点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BB%84%E4%BB%B6-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-text">第二个组件:服务调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LB%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">LB负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IRule-%E6%A0%B9%E6%8D%AE%E7%89%B9%E5%AE%9A%E7%AE%97%E6%B3%95%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E8%A6%81%E8%AE%BF%E9%97%AE%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-text">IRule:根据特定算法从服务列表中获取一个要访问的服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">Ribbon负载均衡算法的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoundRobinRule%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">RoundRobinRule源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"><span class="toc-text">手写一个负载均衡算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E7%BB%84%E4%BB%B6-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-text">第三个组件:服务调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Feign%E5%92%8COpenFeign%E5%8C%BA%E5%88%AB"><span class="toc-text">Feign和OpenFeign区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E7%9A%84%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6"><span class="toc-text">OpenFeign的超时控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E7%9A%84%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0"><span class="toc-text">OpenFeign的日志打印</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E4%B8%AA%E7%BB%84%E4%BB%B6-%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7-%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E3%80%81%E9%99%90%E5%88%B6%E9%99%90%E6%B5%81%E3%80%81%E6%9C%8D%E5%8A%A1%E9%9A%94%E7%A6%BB"><span class="toc-text">第四个组件:服务降级(服务熔断、限制限流、服务隔离)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">分布式系统面临的问题:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">Hystrix是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-text">Hystrix重要概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6"><span class="toc-text">服务熔断机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E5%8E%9F%E7%90%86"><span class="toc-text">服务熔断原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-text">服务熔断配置参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HystrixCommandProperties%E8%AE%B0%E5%BD%95%E6%89%80%E6%9C%89%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-text">HystrixCommandProperties记录所有默认配置属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E6%80%BB%E7%BB%93"><span class="toc-text">服务熔断总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">工作流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringCloud%E5%8D%87%E7%BA%A7%E5%90%8E%E7%9B%91%E6%8E%A7%E6%9C%8D%E5%8A%A1%E7%95%99%E4%B8%8B%E7%9A%84%E5%9D%91"><span class="toc-text">SpringCloud升级后监控服务留下的坑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%9C%8B"><span class="toc-text">如何看</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E4%B8%AA%E7%BB%84%E4%BB%B6-Gateway%E7%BD%91%E5%85%B3"><span class="toc-text">第五个组件:Gateway网关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringCloudGateway"><span class="toc-text">SpringCloudGateway</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E6%A1%86%E6%9E%B6%E8%AE%A4%E8%AF%81"><span class="toc-text">底层框架认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%BD%91%E5%85%B3%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="toc-text">微服务架构中网关在哪里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E4%BA%86zuul%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E9%80%89%E6%8B%A9Gateway"><span class="toc-text">有了zuul为什么还选择Gateway?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zuul%E6%A8%A1%E5%9E%8B"><span class="toc-text">zuul模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gateWay"><span class="toc-text">gateWay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">三大核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">自定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E4%B8%AA%E7%BB%84%E4%BB%B6-Config%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-text">第六个组件:Config服务配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E4%B8%AA%E7%BB%84%E4%BB%B6-Naocs%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-text">第七个组件:Naocs服务注册和配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">服务注册中心的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E5%92%8CCAP"><span class="toc-text">Nacos和CAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E6%94%AF%E6%8C%81AP%E5%92%8CCP%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%87%E6%8D%A2"><span class="toc-text">Nacos支持AP和CP模式的切换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%AA%E5%85%AB%E7%BB%84%E4%BB%B6-Sentinel%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81"><span class="toc-text">第个八组件:Sentinel熔断与限流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sentinel-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">Sentinel 是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix-VS-Sentinel"><span class="toc-text">Hystrix VS Sentinel</span></a></li></ol></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/longshenzhifeijue "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:xufei20160601@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/longshenzhifeijue">XuFei</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>