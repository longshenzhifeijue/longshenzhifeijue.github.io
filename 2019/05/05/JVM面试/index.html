

<!DOCTYPE html>
<html lang="en" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>JVM面试 - Hexo</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content=" JVM面试

1、JVM 复习串讲
JVM 内存结构...">
  <meta name="author" content="Xu Fei">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '/images/theme/loading.gif'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '真正的大师，永远怀着一颗学徒的心',
          typing: false,
          api: '',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">JVM面试</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 摄影</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/longshenzhifeijue">XuFei</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="http://xmt.ssluxury.cn/v2-c9a641a97b5fb90d0d028c9af94dc88b_1440w.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">JVM面试</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>May 05, 2019</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>45839</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h2 id="1、JVM-复习串讲"><a href="#1、JVM-复习串讲" class="headerlink" title="1、JVM 复习串讲"></a>1、JVM 复习串讲</h2><blockquote>
<p><strong>JVM 内存结构</strong></p>
</blockquote>
<ul>
<li><p>JVM复习回顾<br><img    class="lazyload" data-original="http://xmt.ssluxury.cn/image-20210713205425894.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20210713205425894</span></p>
</li>
<li><p>JVM 体系结构</p>
</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165130392-20201010165143012.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809131714186</span></p>
<ul>
<li>Java8以后的JVM</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165225496.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809131831081</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165122287.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809131844945</span></p>
<blockquote>
<p><strong>GC 的作用域</strong></p>
</blockquote>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165233225.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809131923638</span></p>
<blockquote>
<p><strong>常见的垃圾收集算法</strong></p>
</blockquote>
<ol>
<li><p>引用计数算法</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165155698.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809132101920</span></p>
</li>
<li><p>复制算法</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165208618.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809132244162</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165243793.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809132323185</span></p>
</li>
<li><p>标记清除算法</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165249723.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809132458066</span></p>
</li>
<li><p>标记整理算法</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165255695.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809132537491</span></p>
</li>
</ol>
<h2 id="2、谈谈-GC-Roots"><a href="#2、谈谈-GC-Roots" class="headerlink" title="2、谈谈 GC Roots"></a>2、谈谈 GC Roots</h2><blockquote>
<p><strong>JM垃圾回收的时候如何确定垃圾?是否知道什么是 GC Roots？</strong></p>
</blockquote>
<p><strong>什么是垃圾？</strong></p>
<p>简单的说就是内存中已经不再被使用到的空间就是垃圾</p>
<hr>
<p><strong>引用计数算法</strong></p>
<ol>
<li>Java中，引用和对象是有关联的。如果要操作对象则必须用引用进行。</li>
<li>因此，很显然一个简单的办法是通过引用计数来判断一个对象是否可以回收。简单说，给对象中</li>
<li>添加一个引用计数器，每当有一个地方引用它，计数器值加1，每当有一个引用失效时，计数器值减1。</li>
<li>任何时刻计数器值为零的对象就是不可能再被使用的，那么这个对象就是可回收对象。</li>
<li>那为什么主流的Java虚拟机里面都没有选用这种算法呢？其中最主要的原因是它很难解决对象之间相互<strong>循环引用</strong>的问题。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165312716.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809133037473</span></p>
<hr>
<p><strong>枚举根节点做可达性分析（根搜索路径）</strong></p>
<ol>
<li>为了解决引用计数法的循环引用问题，Java使用了可达性分析的方法。</li>
<li>所谓“GCroots”或者说tracing GC的“根集合”就是一组必须活跃的引用。</li>
<li>基本思路就是通过一系列名为”GC Roots”的对象作为起始点，从这个被称为GC Roots的对象开始向下搜索，如果一个对象到GC Roots没有任何引用链相连时，则说明此对象不可用。</li>
<li>也即给定一个集合的引用作为根出发，通过引用关系遍历对象图，能被遍历到的（可到达的）对象就被判定为存活；没有被遍历到的就自然被判定为死亡。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165340423.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809133219692</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165335216.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809133550098</span></p>
<p><strong>那么问题来了，哪些可作为GC Roots的对象</strong></p>
<ol>
<li><strong>虚拟机栈</strong>（栈帧中的局部变量区，也叫局部变量表）中引用的对象</li>
<li>方法区中的<strong>静态属性</strong>引用的对象</li>
<li>方法区中<strong>常量</strong>引用的对象</li>
<li><strong>本地方法栈JNI</strong>（Native方法）引用的对象</li>
</ol>
<h2 id="3、JVM-系统默认值"><a href="#3、JVM-系统默认值" class="headerlink" title="3、JVM 系统默认值"></a>3、JVM 系统默认值</h2><blockquote>
<p><strong>JVM常用基本配置参数有哪些？</strong></p>
</blockquote>
<h3 id="3-1、JVM参数类型"><a href="#3-1、JVM参数类型" class="headerlink" title="3.1、JVM参数类型"></a>3.1、JVM参数类型</h3><h4 id="3-1-1、标配参数"><a href="#3-1-1、标配参数" class="headerlink" title="3.1.1、标配参数"></a>3.1.1、标配参数</h4><blockquote>
<p><strong>在jdk各个版本之间稳定，很有大的变化</strong></p>
</blockquote>
<ol>
<li>-version</li>
<li>-help</li>
<li>java -showversion</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165346897.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809135705913</span></p>
<h4 id="3-1-2、X-参数"><a href="#3-1-2、X-参数" class="headerlink" title="3.1.2、X 参数"></a>3.1.2、X 参数</h4><blockquote>
<p><strong>X 参数了解即可</strong></p>
</blockquote>
<ol>
<li>-Xint（修改编译模式）</li>
<li>-Xcomp</li>
<li>-Xmixed</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165355558.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809135840370</span></p>
<h4 id="3-1-3、XX-参数"><a href="#3-1-3、XX-参数" class="headerlink" title="3.1.3、XX 参数"></a>3.1.3、XX 参数</h4><blockquote>
<p><strong>1、Boolean 类型</strong></p>
</blockquote>
<p><strong>公式：-XX：+或者- 某个属性，+表示开启、-表示关闭</strong></p>
<hr>
<p><strong>示例</strong></p>
<ol>
<li>是否打印GC收集细节：<ul>
<li>-XX:-PrintGCDetails</li>
<li>-XX:+PrintGCDetails</li>
</ul>
</li>
<li>是否使用串行垃圾回收器<ul>
<li>-XX:-UseSerialGC</li>
<li>-XX:+UseSerialGC</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>2、KV键值对类型</strong></p>
</blockquote>
<p><strong>公式：-XX:属性key=属性值value</strong></p>
<hr>
<p><strong>示例</strong></p>
<ol>
<li>-XX:MetaspaceSize=128m</li>
<li>-XX:MaxTenuringThreshold=15</li>
</ol>
<blockquote>
<p><strong>题外话：jinfo 如何查看当前运行程序的配置</strong></p>
</blockquote>
<p><strong>公式 1：jinfo -flag 配置项 进程编号</strong></p>
<p><strong>公式 2：jinfo -flags 进程编号</strong></p>
<hr>
<p><strong>示例</strong></p>
<ol>
<li>jps -l ：得到 JVM 进程编号</li>
<li>jinfo -flag PrintGCDetails pid ：查看 PrintGCDetails 属性是否开启（pid 为进程编号）</li>
</ol>
<blockquote>
<p><strong>题外话：两个经典参数 -Xms和-Xmx</strong></p>
</blockquote>
<ol>
<li>-Xms：等价于-XX:InitialHeapSize</li>
<li>-Xmx：等价于-XX:MaxHeapSize</li>
</ol>
<h3 id="3-2、查看-JVM-默认值"><a href="#3-2、查看-JVM-默认值" class="headerlink" title="3.2、查看 JVM 默认值"></a>3.2、查看 JVM 默认值</h3><blockquote>
<p><strong>-XX:+PrintFlagsInitial：主要查看初始默认值</strong></p>
</blockquote>
<p><strong>公式：</strong></p>
<ol>
<li>java -XX:+PrintFlagsInitial -version</li>
<li>java -XX:+PrintFlagsInitial</li>
</ol>
<hr>
<p><strong>示例</strong></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165403637.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809145053182</span></p>
<blockquote>
<p><strong>-XX:+PrintFlagsfinal：主要查看修改更新</strong></p>
</blockquote>
<p><strong>公式：java -XX:+PrintFlagsFinal -version</strong></p>
<hr>
<p><strong>示例</strong></p>
<ol>
<li>= 表示没被修改过</li>
<li>:= 表示 JVM 默认加载时修改过或人为修改过</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165409620.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809145357151</span></p>
<blockquote>
<p><strong>PrintFlagsFinal举例：运行Java命令的同时打印出参数</strong></p>
</blockquote>
<ul>
<li>java -XX:+PrintFlagsFinal -XX:MetaspaceSize=512m T（T 为 Java 类名）</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165416745.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809150346264</span></p>
<blockquote>
<p><strong>-XX:+PrintCommandLineFlags：打印命令行参数</strong></p>
</blockquote>
<p><strong>公式：java -XX:+PrintCommandLineFlags -version</strong></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">C:\Users\Heygo\Desktop\Interview&gt;<span class="hljs-keyword">java </span>-XX:+PrintCommandLineFlags -version<br>-XX:InitialHeapSize=<span class="hljs-number">266620736</span> -XX:MaxHeapSize=<span class="hljs-number">4265931776</span> -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocatio<br>n -XX:+UseParallelGC<br><span class="hljs-keyword">java </span>version <span class="hljs-string">&quot;1.8.0_144&quot;</span><br><span class="hljs-keyword">Java(TM) </span>SE Runtime Environment (<span class="hljs-keyword">build </span><span class="hljs-number">1</span>.<span class="hljs-number">8</span>.<span class="hljs-number">0</span>_144-<span class="hljs-keyword">b01)</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Java </span>HotSpot(TM) <span class="hljs-number">64</span>-<span class="hljs-keyword">Bit </span>Server VM (<span class="hljs-keyword">build </span><span class="hljs-number">25</span>.<span class="hljs-number">144</span>-<span class="hljs-keyword">b01, </span>mixed mode)<br><span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>

<h2 id="4、JVM-常用参数"><a href="#4、JVM-常用参数" class="headerlink" title="4、JVM 常用参数"></a>4、JVM 常用参数</h2><blockquote>
<p><strong>基础知识复习</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> HelloGC</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 15:12</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloGC</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> totalMemory = Runtime.getRuntime().totalMemory(); <span class="hljs-comment">// Java 虚拟机中的内存总量</span><br>        <span class="hljs-keyword">long</span> maxMemory = Runtime.getRuntime().maxMemory(); <span class="hljs-comment">// Java 虚拟机试图使用的最大内存量</span><br>        System.out.println(<span class="hljs-string">&quot;TOTAL_MEMORY：&quot;</span> + totalMemory / (<span class="hljs-keyword">double</span>) <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> + <span class="hljs-string">&quot;MB&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;MAX_MEMORY：&quot;</span> + maxMemory / (<span class="hljs-keyword">double</span>) <span class="hljs-number">1014</span> / <span class="hljs-number">1024</span> + <span class="hljs-string">&quot;MB&quot;</span>);<br>    &#125;<br><br>&#125;<br><span class="hljs-number">1234567891011121314151617</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>常用参数</strong></p>
</blockquote>
<ol>
<li><p>-<strong>Xms</strong>：初始大小内存，默认为物理内存1/64，等价于-XX:InitialHeapSize</p>
</li>
<li><p>-<strong>Xmx</strong>：最大分配内存，默认为物理内存1/4，等价于-XX:MaxHeapSize</p>
</li>
<li><p>-<strong>Xss</strong>：设置单个线程栈的大小，等价于-XX:ThreadStackSize，一般默认为512~1024K；0代表默认出厂值</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165431630.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809152404315</span></p>
</li>
<li><p>-<strong>Xmn</strong>：设置年轻代大小</p>
</li>
<li><p><strong>-XX:MetaSpaceSize</strong>：设置元空间大小</p>
<ul>
<li>元空间本质和永久代类似，都是对JVM中方法区的实现。不过元空间与永久代之间最大的区别是：元空间并不在虚拟机中，而是使用本地内存。</li>
<li>因此，默认情况下，元空间的大小仅受本地内存限制，默认大小约为 21M</li>
<li>-Xms10m -Xmx10m -XX:MetaSpaceSize=1024m -XX:+PrintFlagsFinal</li>
</ul>
</li>
<li><p><strong>-XX:+PrintGCDetails</strong>：输出详细GC收集日志信息。</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165439738.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809160807668</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165445229.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809160146469</span></p>
</li>
<li><p><strong>-XX:SurvivorRatio</strong>：设置新生代中Eden和S0/S1空间的比例</p>
<ul>
<li>默认-XX:SurvivorRatio=8，则Eden:S0:S1 = 8:1:1</li>
<li>假如设置 -XX:SurvivorRatio=4，则新生代中 Eden:S0:S1=4:1:1</li>
<li>即SurvivorRatio值就是设置Eden区的比例占多少，S0/S1相同</li>
</ul>
</li>
<li><p><strong>-XX:NewRatio</strong>：配置年轻代与老年代在堆结构的占比</p>
<ul>
<li>默认-XX:NewRatop=2，新生代占1，老年代占2，即新生代占整个堆的1/3</li>
<li>假如设置参数-XX:NewRatop=4，新生代占1，老年代占4，即新生代占整个堆的1/5</li>
<li>NewRatio就是老年代占比，剩下的1给年轻代</li>
</ul>
</li>
<li><p><strong>-XX:MaxTenuringThreshold</strong>：设置垃圾最大年龄</p>
<ul>
<li>-XX:MaxTenuringThreshold=0：设置垃圾最大年龄。如果设置为0的话，则年轻代对象不经过Survivor区，直接进入年老代。对于年老代比较多的应用，可以提高效率。</li>
<li>如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象在年轻代的存活时间，增加对象在年轻代被回收的概率</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>典型设置案例：可以和面试官闲聊的案例</strong></p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-Xms4096m -Xmx4096m -Xss1024k -XX:<span class="hljs-attribute">MetaSpaceSize</span>=512m -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseSerialGC<br>1<br></code></pre></td></tr></table></figure>

<h2 id="5、四中引用类型"><a href="#5、四中引用类型" class="headerlink" title="5、四中引用类型"></a>5、四中引用类型</h2><blockquote>
<p><strong>强引用、软引用、弱引用、虚引用分别是什么？</strong></p>
</blockquote>
<h3 id="5-1、整体架构"><a href="#5-1、整体架构" class="headerlink" title="5.1、整体架构"></a>5.1、整体架构</h3><p>强、软、弱、虚</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165452415.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809163141865</span></p>
<h3 id="5-2、四种引用"><a href="#5-2、四种引用" class="headerlink" title="5.2、四种引用"></a>5.2、四种引用</h3><h4 id="5-2-1、强引用"><a href="#5-2-1、强引用" class="headerlink" title="5.2.1、强引用"></a>5.2.1、强引用</h4><blockquote>
<p><strong>强引用（默认支持模式）</strong></p>
</blockquote>
<ol>
<li>当内存不足，JVM开始垃圾回收，对于强引用的对象，<strong>就算是出现了OOM也不会对该对象进行回收，死都不收</strong>。</li>
<li>强引用是我们最常见的普通对象引用，只要还有强引用指向一个对象，就能表明对象还“活着”，垃圾收集器不会碰这种对象</li>
<li>在Java中最常见的就是强引用，把一个对象赋给一个引用变量，这个引用变量就是一个强引用。当一个对象被强引用变量引用时，它处于可达。状态，它是不可能被垃圾回收机制回收的，即使该对象以后远都不会被用到JVM也不会回收。<strong>因此强引用是造成Java内存泄漏的主要原因之一</strong></li>
<li>对于一个普通的对象，如果没有其他的引用关系，只要超过了引用的作用域或者显式地将相应（强）引用赋值为null，一般认为就是可以被垃圾收集的了（当然具体回收时机还是要看垃圾收集策略）</li>
</ol>
<h4 id="5-2-2、软引用"><a href="#5-2-2、软引用" class="headerlink" title="5.2.2、软引用"></a>5.2.2、软引用</h4><blockquote>
<p><strong>软引用的含义</strong></p>
</blockquote>
<ol>
<li>软引用是一种相对强引用弱化了一些的引用，需要用java.lang.ref.SoftReference类来实现，可以让对象豁免一些垃圾收集。</li>
<li>对于只有软引用的对象来说，<strong>当系统内存充足时它不会被回收，当系统内存不足时它会被回收</strong>。</li>
<li>软引用通常用在对内存敏感的程序中，比如<strong>高速缓存</strong>就有用到软引用，内存够用的时候就保留，不够用就回收！</li>
</ol>
<blockquote>
<p><strong>软引用代码示例</strong></p>
</blockquote>
<p><strong>示例 1：内存够用不会回收软引用对象</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 内存够用的时候就保留，不够用就回收</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> SoftReferenceDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 21:54</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SoftReferenceDemo</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        softRef_Memory_Enough();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">softRef_Memory_Enough</span><span class="hljs-params">()</span> </span>&#123;<br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        SoftReference&lt;Object&gt; softReference = <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(o1);<br>        System.out.println(o1);<br>        System.out.println(softReference.get());<br><br>        o1 = <span class="hljs-keyword">null</span>;<br>        System.gc(); <span class="hljs-comment">// 进行 GC</span><br>        System.out.println(o1); <span class="hljs-comment">// 强引用变量为 null 必被回收</span><br>        System.out.println(softReference.get()); <span class="hljs-comment">// 内存够用不会回收软引用对象</span><br>    &#125;<br>    <br>&#125;<br><span class="hljs-number">12345678910111213141516171819202122232425262728</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：软引用对象并没有被回收</li>
</ul>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">java.lang.Object<span class="hljs-title">@4554617</span><span class="hljs-keyword">c</span><br>java.lang.Object<span class="hljs-title">@4554617</span><span class="hljs-keyword">c</span><br><span class="hljs-keyword">null</span><br>java.lang.Object<span class="hljs-title">@4554617</span><span class="hljs-keyword">c</span><br><span class="hljs-number">1234</span><br></code></pre></td></tr></table></figure>

<hr>
<p><strong>示例 2：内存不够用必定回收软引用对象</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 内存够用的时候就保留，不够用就回收</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> SoftReferenceDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 21:54</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SoftReferenceDemo</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//softRef_Memory_Enough();</span><br>        softRef_Memory_NotEnough();<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        JVm配置，故意产生大对象并配置小的内存，让内存不够用，导致OOM，看软引用的回收情况</span><br><span class="hljs-comment">        -Xms5m -Xmx5m -XX:+PrintGCDetails</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">softRef_Memory_NotEnough</span><span class="hljs-params">()</span> </span>&#123;<br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        SoftReference&lt;Object&gt; softReference = <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(o1);<br>        System.out.println(o1);<br>        System.out.println(softReference.get());<br><br>        o1 = <span class="hljs-keyword">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">30</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            System.out.println(o1);<br>            System.out.println(softReference.get());<br>        &#125;<br>    &#125;<br><br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：OOM 之前，必定进行一次 Full GC ，此时会清除软引用对象</li>
</ul>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">1024</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">504</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1024</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">640</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0008207</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">Object</span><span class="hljs-operator">@</span><span class="hljs-number">4554617</span><span class="hljs-variable">c</span><br><span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">Object</span><span class="hljs-operator">@</span><span class="hljs-number">4554617</span><span class="hljs-variable">c</span><br><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">1403</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">504</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1539</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">752</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0007773</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">504</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">504</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">752</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0005913</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">504</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">264</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">4096</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">768</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3426</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3426</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0055154</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.09</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0002769</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">OutOfMemoryError</span><span class="hljs-operator">:</span> <span class="hljs-variable">Java</span> <span class="hljs-variable">heap</span> <span class="hljs-variable">space</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">com</span><span class="hljs-operator">.</span><span class="hljs-variable">Heygo</span><span class="hljs-operator">.</span><span class="hljs-variable">SoftReferenceDemo</span><span class="hljs-operator">.</span><span class="hljs-type">softRef_Memory</span><span class="hljs-type">_NotEnough</span><span class="hljs-punctuation">(</span><span class="hljs-variable">SoftReferenceDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">46</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">com</span><span class="hljs-operator">.</span><span class="hljs-variable">Heygo</span><span class="hljs-operator">.</span><span class="hljs-variable">SoftReferenceDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">main</span><span class="hljs-punctuation">(</span><span class="hljs-variable">SoftReferenceDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">18</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">620</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">4096</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">637</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">620</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">5632</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3426</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3426</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0056716</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-variable">null</span><br><span class="hljs-variable">null</span><br><span class="hljs-variable">Heap</span><br> <span class="hljs-variable">PSYoungGen</span>      <span class="hljs-variable">total</span> <span class="hljs-number">1536</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">used</span> <span class="hljs-number">92</span><span class="hljs-built_in">K</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe00000</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-variable">x0000000100000000</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-variable">x0000000100000000</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-variable">eden</span> <span class="hljs-variable">space</span> <span class="hljs-number">1024</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-number">9</span><span class="hljs-operator">%</span> <span class="hljs-variable">used</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe00000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe173f8</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff00000</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-variable">from</span> <span class="hljs-variable">space</span> <span class="hljs-number">512</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-operator">%</span> <span class="hljs-variable">used</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff80000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff80000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x0000000100000000</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-variable">to</span>   <span class="hljs-variable">space</span> <span class="hljs-number">512</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-operator">%</span> <span class="hljs-variable">used</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff00000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff00000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000fff80000</span><span class="hljs-punctuation">)</span><br> <span class="hljs-variable">ParOldGen</span>       <span class="hljs-variable">total</span> <span class="hljs-number">4096</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">used</span> <span class="hljs-number">620</span><span class="hljs-built_in">K</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffa00000</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe00000</span><span class="hljs-operator">,</span> <span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe00000</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-variable">object</span> <span class="hljs-variable">space</span> <span class="hljs-number">4096</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-number">15</span><span class="hljs-operator">%</span> <span class="hljs-variable">used</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffa00000</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffa9b138</span><span class="hljs-operator">,</span><span class="hljs-number">0</span><span class="hljs-variable">x00000000ffe00000</span><span class="hljs-punctuation">)</span><br> <span class="hljs-variable">Metaspace</span>       <span class="hljs-variable">used</span> <span class="hljs-number">3487</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">capacity</span> <span class="hljs-number">4496</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">committed</span> <span class="hljs-number">4864</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">reserved</span> <span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><br>  <span class="hljs-variable">class</span> <span class="hljs-variable">space</span>    <span class="hljs-variable">used</span> <span class="hljs-number">382</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">capacity</span> <span class="hljs-number">388</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">committed</span> <span class="hljs-number">512</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span> <span class="hljs-variable">reserved</span> <span class="hljs-number">1048576</span><span class="hljs-built_in">K</span><br><span class="hljs-number">12345678910111213141516171819202122</span><br></code></pre></td></tr></table></figure>

<h4 id="5-2-3、弱引用"><a href="#5-2-3、弱引用" class="headerlink" title="5.2.3、弱引用"></a>5.2.3、弱引用</h4><blockquote>
<p><strong>弱引用的含义</strong></p>
</blockquote>
<p>弱引用需要用java.lang.ref.WeakReference类来实现，它比软引用的生存期更短，对于只有弱引用的对象来说，<strong>只要垃圾回收机制一运行，不管JVM的内存空间是否足够，都会回收该对象占用的内存</strong>。</p>
<blockquote>
<p><strong>弱引用代码示例</strong></p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> WeakReferenceDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:09</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeakReferenceDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        WeakReference&lt;Object&gt; weakReference = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(o1);<br>        System.out.println(o1);<br>        System.out.println(weakReference.get());<br><br>        o1 = <span class="hljs-keyword">null</span>;<br>        System.gc();<br>        System.out.println(<span class="hljs-string">&quot;...............&quot;</span>);<br><br>        System.out.println(o1);<br>        System.out.println(weakReference.get());<br>    &#125;<br>&#125;<br><span class="hljs-number">12345678910111213141516171819202122</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：执行 GC，弱引用对象被回收</li>
</ul>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lasso">java.lang.Object@<span class="hljs-number">4554617</span>c<br>java.lang.Object@<span class="hljs-number">4554617</span>c<br><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><br><span class="hljs-built_in">null</span><br><span class="hljs-built_in">null</span><br><span class="hljs-number">12345</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>你知道弱引用的话，谈谈WeakHashMap</strong></p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> WeakHashMapDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:14</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeakHashMapDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br>        myHashMap();<br>        System.out.println(<span class="hljs-string">&quot;========&quot;</span>);<br>        myWeakHashMap();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myHashMap</span><span class="hljs-params">()</span></span>&#123;<br>        HashMap&lt;Integer,String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        Integer key = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">1</span>);<br>        String value = <span class="hljs-string">&quot;HashMap&quot;</span>;<br><br>        map.put(key,value);<br>        System.out.println(map);<br><br>        <span class="hljs-comment">// key 置为 null ，关 HashMap 毛事啊，HashMap 已经将数据保存至 Node 节点中了</span><br>        key = <span class="hljs-keyword">null</span>;<br>        System.out.println(map);<br><br>        System.gc();<br>        System.out.println(map);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myWeakHashMap</span><span class="hljs-params">()</span></span>&#123;<br>        WeakHashMap&lt;Integer,String&gt; map = <span class="hljs-keyword">new</span> WeakHashMap&lt;&gt;();<br>        Integer key = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">2</span>);<br>        String value = <span class="hljs-string">&quot;WeakHashMap&quot;</span>;<br><br>        map.put(key,value);<br>        System.out.println(map);<br><br>        key = <span class="hljs-keyword">null</span>;<br>        System.out.println(map);<br><br>        System.gc();<br>        System.out.println(map);<br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：如果 WeakHashMap 的 key 为 null ，GC 后该 KV 节点将被回收</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">&#123;1=HashMap&#125;<br>&#123;1=HashMap&#125;<br><span class="hljs-section">&#123;1=HashMap&#125;</span><br><span class="hljs-section">========</span><br>&#123;2=WeakHashMap&#125;<br>&#123;2=WeakHashMap&#125;<br>&#123;&#125;<br>1234567<br></code></pre></td></tr></table></figure>

<h4 id="5-2-4、虚引用"><a href="#5-2-4、虚引用" class="headerlink" title="5.2.4、虚引用"></a>5.2.4、虚引用</h4><blockquote>
<p><strong>虚引用的作用</strong></p>
</blockquote>
<ol>
<li>虚引用需要java.lang.ref.PhantomReference类来实现。顾名思义，就是形同虚设，与其他几种引用都不同，虚引用并不会决定对象的生命周期。</li>
<li>如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收器回收，它不能单独使用也不能通过它访问对象，虚引用必须和引用队列ReferenceQueue联合使用。</li>
<li><strong>虚引用的主要作用是跟踪对象被垃圾回收的状态</strong>。仅仅是提供了一种确保对象被finalize以后，做某些事情的机制。</li>
<li>PhantomReference的get方法总是返回null，因此无法访问对应的引用对象。其意义在于说明一个对象已经进入finalization阶段，可以被gc回收，用来实现比finalization机制更灵活的回收操作。</li>
<li>换句话说，设置虚引用关联的唯一目的，就是在这个对象被收集器回收的时候收到一个系统通知或者后续添加进一步的处理。</li>
<li>Java 技术允许使用finalize()方法在垃圾收集器将对象从内存中清除出去之前做必要的清理工作。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165513467.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809222628859</span></p>
<hr>
<p>引用队列：我（虚引用）被回收前需要被引用队列保存下</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165519314.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809222927023</span></p>
<hr>
<p><strong>引用队列代码示例</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> ReferenceQueueDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:30</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReferenceQueueDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>&#123;<br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        ReferenceQueue&lt;Object&gt; referenceQueue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br>        WeakReference&lt;Object&gt; weakReference = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(o1,referenceQueue);<br>        System.out.println(o1);<br>        System.out.println(weakReference.get());<br>        System.out.println(referenceQueue.poll());<br><br>        System.out.println(<span class="hljs-string">&quot;=============&quot;</span>);<br>        o1 = <span class="hljs-keyword">null</span>;<br>        System.gc();<br>        Thread.sleep(<span class="hljs-number">500</span>);<br><br>        System.out.println(o1);<br>        System.out.println(weakReference.get());<br>        System.out.println(referenceQueue.poll());<br>    &#125;<br>&#125;<br><span class="hljs-number">1234567891011121314151617181920212223242526</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：在 GC 回收之前，将待回收的对象放入引用队列中，有点类似 Spring AOP 的后置通知</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">java.lang.Object@4554617c<br>java.lang.Object@4554617c<br><span class="hljs-section">null</span><br><span class="hljs-section">=============</span><br>null<br>null<br>java.lang.ref.WeakReference@74a14482<br>1234567<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>虚引用代码示例</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> PhantomReferenceDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:30</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhantomReferenceDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        ReferenceQueue&lt;Object&gt; referenceQueue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br>        PhantomReference&lt;Object&gt; phantomReference = <span class="hljs-keyword">new</span> PhantomReference&lt;&gt;(o1,referenceQueue);<br><br>        System.out.println(o1);<br>        System.out.println(phantomReference.get());<br>        System.out.println(referenceQueue.poll());<br><br>        System.out.println(<span class="hljs-string">&quot;=================&quot;</span>);<br>        o1 = <span class="hljs-keyword">null</span>;<br>        System.gc();<br>        Thread.sleep(<span class="hljs-number">500</span>);<br><br>        System.out.println(o1);<br>        System.out.println(phantomReference.get());<br>        System.out.println(referenceQueue.poll());<br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324252627</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：对象被回收时，将其放入了引用队列</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">java.lang.Object@4554617c<br>null<br><span class="hljs-section">null</span><br><span class="hljs-section">=================</span><br>null<br>null<br>java.lang.ref.PhantomReference@74a14482<br>1234567<br></code></pre></td></tr></table></figure>

<h3 id="5-3、引用总结"><a href="#5-3、引用总结" class="headerlink" title="5.3、引用总结"></a>5.3、引用总结</h3><blockquote>
<p><strong>软引用、弱引用适用场景</strong></p>
</blockquote>
<ol>
<li>假如有一个应用需要读取大量的本地图片：<ul>
<li>如果每次读取图片都从硬盘读取则会严重影响性能，</li>
<li>如果一次性全部加载到内存中又可能造成内存溢出。</li>
</ul>
</li>
<li>此时使用软引用可以解决这个问题。设计思路是：<strong>用一个HashMap来保存图片的路径和相应图片对象关联的软引用之间的映射关系，在内存不足时，JVM会自动回收这些缓存图片对象所占用的空间，从而有效地避免了OOM的问题</strong>。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String，SoftReference&lt;Bitmap&gt;&gt; imageCache = <span class="hljs-keyword">new</span> HashMap&lt;String，SoftReference&lt;Bitmap&gt;&gt;();<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>GC Roots 和四种引用类型的总结</strong></p>
</blockquote>
<ol>
<li>java提供了4种引用类型，在垃级回收的时候，都有自己各自的特点。</li>
<li><strong>ReferenceQueue是用来配合引用工作的，没有有ReferenceQueue一样可以运行</strong>。</li>
<li>创建引用的时候可以指定关联的队列，当GC释放对象内存的时候，会将引用加入到引用队列，如果程序发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象的内存被回收之前采取必要的行动这相当于是一种通知机制。</li>
<li>当关联的引用队列中有数据的时候，意味着引用指向的堆内存中的对象被回收。通过这种方式，JVM允许我们在对象被销毁后，做一些我们自己想做的事情。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165533619.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809224115087</span></p>
<h2 id="6、OOM"><a href="#6、OOM" class="headerlink" title="6、OOM"></a>6、OOM</h2><blockquote>
<p><strong>面试题：请谈谈你对OOM的认识</strong></p>
</blockquote>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165540367.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809225302583</span></p>
<blockquote>
<p><strong>java.lang.StackOverflowError</strong></p>
</blockquote>
<ul>
<li>代码：递归调用无结束条件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> StackOverflowErrorDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:48</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StackOverflowErrorDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br>        stackOverflowError();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stackOverflowError</span><span class="hljs-params">()</span> </span>&#123;<br>        stackOverflowError();<br>    &#125;<br>&#125;<br><span class="hljs-number">12345678910111213141516</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs julia"><span class="hljs-built_in">Exception</span> <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java.lang.<span class="hljs-built_in">StackOverflowError</span><br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>java.lang.OutOfMemoryError:Java heap space</strong></p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> JavaHeapSpaceDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 22:53</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaHeapSpaceDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br>        String str = <span class="hljs-string">&quot;seu&quot;</span>;<br><br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>            str += str + <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">11111111</span>)+<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">22222222</span>);<br>            str.intern();<br>        &#125;<br><br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718</span><br></code></pre></td></tr></table></figure>

<ul>
<li>JVM 参数</li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m</span><br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.OutOfMemoryError</span>: Java heap space<br>	at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Arrays</span><span class="hljs-selector-class">.copyOf</span>(Arrays<span class="hljs-selector-class">.java</span>:<span class="hljs-number">3332</span>)<br>	at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.AbstractStringBuilder</span><span class="hljs-selector-class">.ensureCapacityInternal</span>(AbstractStringBuilder<span class="hljs-selector-class">.java</span>:<span class="hljs-number">124</span>)<br>	at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.AbstractStringBuilder</span><span class="hljs-selector-class">.append</span>(AbstractStringBuilder<span class="hljs-selector-class">.java</span>:<span class="hljs-number">674</span>)<br>	at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.StringBuilder</span><span class="hljs-selector-class">.append</span>(StringBuilder<span class="hljs-selector-class">.java</span>:<span class="hljs-number">208</span>)<br>	at com<span class="hljs-selector-class">.Heygo</span><span class="hljs-selector-class">.JavaHeapSpaceDemo</span><span class="hljs-selector-class">.main</span>(JavaHeapSpaceDemo<span class="hljs-selector-class">.java</span>:<span class="hljs-number">17</span>)<br><span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>java.lang.OutOfMemoryError:GC overhead limit exceeded</strong></p>
</blockquote>
<ol>
<li><strong>GC回收时间过长时会抛出0utOfMemroyError</strong>。过长的定义是，超过98%的时间用来做GC并且回收了不到2%的堆内存</li>
<li>连续多次GC都只回收了不到2%的极端情况下才会抛出。假如不抛出GC overhead Limit 错误会发生什么情况呢？</li>
<li>那就是GC清理的这么点内存很快会再次填满，迫使GC再次执行，这样就形成恶性循环，CPU使用孩一直是100%，而GC却没有任何成效</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165549909.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200809225843069</span></p>
<hr>
<ul>
<li>代码：将生成的字符串放到字符串常量池中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> GCOverheadDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 23:02</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GCOverheadDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>        List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                list.add(String.valueOf(++i).intern());<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;***************i:&quot;</span> + i);<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125;<br><br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324</span><br></code></pre></td></tr></table></figure>

<ul>
<li>JVM 参数</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:<span class="hljs-attribute">MaxDirectMemorySize</span>=5m<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果：GC 说，老铁，我回收不动啊~~~</li>
</ul>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7076</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7076</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9124</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9124</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0304580</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.17</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7078</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7078</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9126</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9126</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0294555</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.11</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7080</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7080</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9128</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9128</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0303605</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.08</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7081</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7081</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9129</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9129</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0273443</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.11</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7083</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7083</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9131</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9131</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0323289</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.13</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7085</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7085</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9133</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9133</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0282554</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.25</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7087</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7087</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9135</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9135</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0279839</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.22</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7088</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7088</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9136</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9136</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0268396</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7090</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7090</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9138</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9138</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0275986</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.14</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7092</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7092</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9140</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9140</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0279635</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.14</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">2047</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">7094</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">7094</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">9142</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">9142</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3472</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0259208</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.22</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.01</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.03</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-operator">***************</span><span class="hljs-variable">i</span><span class="hljs-operator">:</span><span class="hljs-number">145410</span><br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Ergonomics</span><span class="hljs-punctuation">)</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">OutOfMemoryError</span><span class="hljs-operator">:</span> <span class="hljs-variable">GC</span> <span class="hljs-variable">overhead</span> <span class="hljs-variable">limit</span> <span class="hljs-variable">exceeded</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-built_in">Integer</span><span class="hljs-operator">.</span><span class="hljs-variable">toString</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">Integer</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">403</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-built_in">String</span><span class="hljs-operator">.</span><span class="hljs-variable">valueOf</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">String</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">3099</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">com</span><span class="hljs-operator">.</span><span class="hljs-variable">Heygo</span><span class="hljs-operator">.</span><span class="hljs-variable">GCOverheadDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">main</span><span class="hljs-punctuation">(</span><span class="hljs-variable">GCOverheadDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">Exception</span> <span class="hljs-variable">in</span> <span class="hljs-variable">thread</span> <span class="hljs-string">&quot;main&quot;</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">OutOfMemoryError</span><span class="hljs-operator">:</span> <span class="hljs-variable">GC</span> <span class="hljs-variable">overhead</span> <span class="hljs-variable">limit</span> <span class="hljs-variable">exceeded</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-built_in">Integer</span><span class="hljs-operator">.</span><span class="hljs-variable">toString</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">Integer</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">403</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-built_in">String</span><span class="hljs-operator">.</span><span class="hljs-variable">valueOf</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">String</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">3099</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">com</span><span class="hljs-operator">.</span><span class="hljs-variable">Heygo</span><span class="hljs-operator">.</span><span class="hljs-variable">GCOverheadDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">main</span><span class="hljs-punctuation">(</span><span class="hljs-variable">GCOverheadDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br><span class="hljs-number">1234567891011121314151617181920</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>java.lang.OutOfMemoryError:Direct buffer memory</strong></p>
</blockquote>
<p><strong>导致原因：</strong></p>
<ol>
<li><p>写NIO程序经常使用ByteBuffer来读取或者写入数据，这是一种基于通道（Channel）与缓冲区（Buffer）的I/O方式，它可以使用Native函数库</p>
<p>直接分配堆外内存</p>
<p>，然后通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能，因为避免了在Java堆和Native堆中来回复制数据。</p>
<ul>
<li><code>ByteBuffer.allocate(capability)</code>第一种方式是<strong>分配JVM堆内存</strong>，属GC管辖范围，由于需要拷贝所以速度相对较慢</li>
<li><code>ByteBuffer.allocateDirect(capability)</code>第二种方式是<strong>分配OS本地内存</strong>，不属于GC管辖范围，由子不需要内存拷贝所以速度相对较快。</li>
</ul>
</li>
<li><p>但如果不断分配本地内存，堆内存很少使用，那么JVM就不需要执行GC，DirectByteBuffer对象们就不会被回收，这时候堆内存充足，但本地内存可能已经使用光了，再次尝试分配本地内存就会出现OutOfMemoryError，那程序就直接崩溃了</p>
</li>
</ol>
<hr>
<p><strong>代码示例：查看 MaxDirectMemory</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> DirectBufferMemoryDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/9 23:18</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DirectBufferMemoryDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;配置的maxDirectMemory: &quot;</span> + (sun.misc.VM.maxDirectMemory() / (<span class="hljs-keyword">double</span>) <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>) + <span class="hljs-string">&quot;MB&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">300</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        ByteBuffer byteBuffer = ByteBuffer.allocateDirect(<span class="hljs-number">6</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br>    &#125;<br>&#125;<br><span class="hljs-number">12345678910111213141516171819</span><br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">配置的maxDirectMemory: 3618.0MB</span><br>1<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>演示 DirectBuffer OOM</strong></p>
<ul>
<li>代码同上</li>
<li>JVM 参数</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-Xms10m -Xmx10m -XX:<span class="hljs-attribute">MaxDirectMemorySize</span>=5m -XX:+PrintGCDetails<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">配置的<span class="hljs-variable">maxDirectMemory</span><span class="hljs-operator">:</span> <span class="hljs-number">5.0</span><span class="hljs-variable">MB</span><br><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Allocation</span> <span class="hljs-built_in">Failure</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">2035</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">488</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">2035</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">792</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0007089</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">System</span><span class="hljs-operator">.</span><span class="hljs-variable">gc</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">564</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">496</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">868</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">912</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0008965</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-punctuation">[</span><span class="hljs-built_in">Full</span> <span class="hljs-variable">GC</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">System</span><span class="hljs-operator">.</span><span class="hljs-variable">gc</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">PSYoungGen</span><span class="hljs-operator">:</span> <span class="hljs-number">496</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">0</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">2560</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">ParOldGen</span><span class="hljs-operator">:</span> <span class="hljs-number">416</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">705</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">7168</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-number">912</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">705</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">9728</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Metaspace</span><span class="hljs-operator">:</span> <span class="hljs-number">3483</span><span class="hljs-built_in">K</span><span class="hljs-operator">-&gt;</span><span class="hljs-number">3483</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">(</span><span class="hljs-number">1056768</span><span class="hljs-built_in">K</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-operator">,</span> <span class="hljs-number">0.0051785</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">Times</span><span class="hljs-operator">:</span> <span class="hljs-variable">user</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">sys</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span><span class="hljs-operator">,</span> <span class="hljs-variable">real</span><span class="hljs-operator">=</span><span class="hljs-number">0.00</span> <span class="hljs-variable">secs</span><span class="hljs-punctuation">]</span> <br><span class="hljs-variable">Exception</span> <span class="hljs-variable">in</span> <span class="hljs-variable">thread</span> <span class="hljs-string">&quot;main&quot;</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">lang</span><span class="hljs-operator">.</span><span class="hljs-variable">OutOfMemoryError</span><span class="hljs-operator">:</span> <span class="hljs-variable">Direct</span> <span class="hljs-variable">buffer</span> <span class="hljs-variable">memory</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">nio</span><span class="hljs-operator">.</span><span class="hljs-variable">Bits</span><span class="hljs-operator">.</span><span class="hljs-variable">reserveMemory</span><span class="hljs-punctuation">(</span><span class="hljs-variable">Bits</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">694</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">nio</span><span class="hljs-operator">.</span><span class="hljs-variable">DirectByteBuffer</span><span class="hljs-operator">.&lt;</span><span class="hljs-variable">init</span><span class="hljs-operator">&gt;</span><span class="hljs-punctuation">(</span><span class="hljs-variable">DirectByteBuffer</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">123</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">java</span><span class="hljs-operator">.</span><span class="hljs-variable">nio</span><span class="hljs-operator">.</span><span class="hljs-variable">ByteBuffer</span><span class="hljs-operator">.</span><span class="hljs-variable">allocateDirect</span><span class="hljs-punctuation">(</span><span class="hljs-variable">ByteBuffer</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">311</span><span class="hljs-punctuation">)</span><br>	<span class="hljs-variable">at</span> <span class="hljs-variable">com</span><span class="hljs-operator">.</span><span class="hljs-variable">Heygo</span><span class="hljs-operator">.</span><span class="hljs-variable">DirectBufferMemoryDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">main</span><span class="hljs-punctuation">(</span><span class="hljs-variable">DirectBufferMemoryDemo</span><span class="hljs-operator">.</span><span class="hljs-variable">java</span><span class="hljs-operator">:</span><span class="hljs-number">22</span><span class="hljs-punctuation">)</span><br><span class="hljs-number">123456789</span><br></code></pre></td></tr></table></figure>

<hr>
<p><strong>结论：</strong></p>
<p>写 NIO 和 Netty 程序时要小心</p>
<blockquote>
<p><strong>java.lang.OutOfMemoryError:unable to create new native thread</strong></p>
</blockquote>
<p>高并发请求服务器时，经常出现如下错误 <code>java.lang.OutOfMemoryError:unable to create new native thread</code>，准确地讲，该 native thread 异常与对应的平台有关</p>
<hr>
<p><strong>导致原因：</strong></p>
<ol>
<li>你的应用创建了太多线程了，一个应用进程创建多个线程，超过系统承载极限</li>
<li>你的服务器并不允许你的应用程序创建这么多线程，<strong>Linux系统默认允许单个进程可以创建的线程数是1024个</strong>，你的应用创建超过这个数量，就会报<code>java.Lang.outofMemoryError:unable to create new native thread</code></li>
</ol>
<hr>
<p><strong>解决办法：</strong></p>
<ol>
<li>想办法降低你应用程序创建线程的数量，分析应用是否真的需要创建这么多线程，如果不是，改代码将线程数降到最低</li>
<li>对于有的应用，确实需要创建很多线程，远超过Linux系统的默认1024个线程的限制，可以通过修改Linux服务器配置，扩大Linux默认限制</li>
</ol>
<hr>
<p><strong>非root用户登录Linux系统测试</strong></p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.Interview.study..jvm.oom;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> UnableCreateNewThreadDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/10 12:59</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnableCreateNewThreadDemo</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; ; i++) &#123;<br>            System.out.println(i);<br>            <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(Integer.MAX_VALUE);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Linux 编译带包名的 Java源文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -d . UnableCreateNewThreadDemo.java<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>Linux 运行带包名的 Java 程序</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">java com.atguigu.Interview.study..jvm.oom.UnableCreateNewThreadDemo<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165607617.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810131353081</span></p>
<hr>
<p><strong>终止程序</strong></p>
<ul>
<li>当前普通用户无法终止该进程，需要 root 用户帮忙</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -ef|grep java<br><span class="hljs-built_in">kill</span> -9 pid<br>12<br></code></pre></td></tr></table></figure>

<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165613255.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810130959638</span></p>
<hr>
<p><strong>服务器级别调优参数</strong></p>
<ul>
<li>查看当前用户的可创建的最大线程数</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ulimit</span> -u<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>编辑配置文件：可以看到除了 root 用户无限制，其他用户所能创建的最大线程数为 1024</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/security/limits.d/90-nproc.conf<br>1<br></code></pre></td></tr></table></figure>

<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165618480.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810132149348</span></p>
<ul>
<li>我们给张三用户多分配一些线程数</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165623996.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810132358592</span></p>
<blockquote>
<p><strong>java.lang.OutOfMemoryError:Metaspace</strong></p>
</blockquote>
<ol>
<li><strong>Metaspace是方法区在Hotspot中的实现</strong>，它与永久代最大的区别在于：Metaspace并不在虚拟机内存中而是使用<strong>本地内存</strong>，也即在java8中，classe metadata(the virtual machines internal presentation of Java class)，被存储在叫做Metaspace的native memory</li>
<li>Java 8及之后的版本使用Metaspace来替代永久代永久代，存放了以下信息：<ul>
<li>虚拟机加载的<strong>类信息</strong></li>
<li><strong>常量池</strong></li>
<li><strong>静态变量</strong></li>
<li><strong>即时编译后的代码缓存</strong></li>
</ul>
</li>
</ol>
<hr>
<p><strong>代码示例</strong></p>
<ul>
<li>代码：利用 CGLIB 不停地往元空间中加载类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模Metaspace空间溢出，我们不断生成类往元空间灌，类占据的空间总是会超过Metaspace指定的空间大小的</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> MetaspaceOOMTest</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/10 13:28</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MetaspaceOOMTest</span> </span>&#123;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OOMTest</span> </span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<span class="hljs-comment">//模拟多少次后发生异常</span><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                i++;<br>                Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer();<br>                enhancer.setSuperclass(OOMTest.class);<br>                enhancer.setUseCache(<span class="hljs-keyword">false</span>);<br>                enhancer.setCallback(<span class="hljs-keyword">new</span> MethodInterceptor)&#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>                        <span class="hljs-keyword">return</span> methodProxy.invokeSupper(o, args);<br>                    &#125;<br>                    enhancer.create();<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;********多少次后发生了异常：&quot;</span> + i);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839</span><br></code></pre></td></tr></table></figure>

<ul>
<li>JVM 参数</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-XX:<span class="hljs-attribute">MetaspaceSize</span>=8m -XX:<span class="hljs-attribute">MaxMetaspaceSize</span>=8m<br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165631856.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810133839592</span></p>
<h2 id="7、GC-垃圾回收"><a href="#7、GC-垃圾回收" class="headerlink" title="7、GC 垃圾回收"></a>7、GC 垃圾回收</h2><blockquote>
<p><strong>GC垃圾回收算法和垃圾收集器的关系？分别是什么？</strong></p>
</blockquote>
<ol>
<li><p>GC算法（引用计数/复制/标记清除/标记整理）是内存回收的方法论，垃圾收集器是算法的落地实现</p>
</li>
<li><p>目前为止还没有完美的收集器出现，更没有万能的收集器，只有针对具体应用最合适的收集器，进行分代收集</p>
</li>
<li><p>四种主要的垃圾收集器：串行、并行、并发、G1</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165638826.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810134252707</span></p>
</li>
</ol>
<blockquote>
<p><strong>串行垃圾回收器（Serial）</strong></p>
</blockquote>
<p>它为单线程环境设计，且只使用一个线程进行垃圾回收，会暂停所有的用户线程，所以不适合服务器环境</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span><br><span class="hljs-comment">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>并行垃圾回收器（Parallel）</strong></p>
</blockquote>
<p>多个垃圾收集线程并行工作，此时用户线程是暂停的，适用于科学计算/大数据处理首台处理等弱交互场景</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">     --&gt; <span class="hljs-comment">GC</span>         --&gt; <span class="hljs-comment">GC</span>          --&gt; <span class="hljs-comment">GC</span><br><span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span><br>     --&gt; <span class="hljs-comment">GC</span>         --&gt; <span class="hljs-comment">GC</span>          --&gt; <span class="hljs-comment">GC</span><br><span class="hljs-comment">123</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>并发垃圾回收器（Concurrent Mark Sweep）</strong></p>
</blockquote>
<p>用户线程和垃圾收集线程同时执行（不一定并行，可能交替执行）不需要停顿用户线程。互联网公司多用，适用对响应时间有要求的场景</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">     --&gt; <span class="hljs-comment">GC</span>         --&gt; <span class="hljs-comment">程序</span>         --&gt; <span class="hljs-comment">程序</span><br><span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span> --&gt; <span class="hljs-comment">程序</span> --&gt; <span class="hljs-comment">GC</span><br>     --&gt; <span class="hljs-comment">GC</span>         --&gt; <span class="hljs-comment">GC</span>          --&gt; <span class="hljs-comment">程序</span><br><span class="hljs-comment">123</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>G1 垃圾回收器（Garbage first）</strong></p>
</blockquote>
<p>G1垃圾回收器将堆内存分割成不同的区域然后并发地对其进行垃圾回收</p>
<blockquote>
<p><strong>串行与并行、STW与并发</strong></p>
</blockquote>
<ol>
<li>串行与并行的垃圾回收器执行 GC 时，都会中断用户线程，STW 时间都会比较长（相对于并发来讲）</li>
<li>并发垃圾回收器可与用户线程并发执行，降低了 STW 的时间</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165648397.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810135311794</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165657235.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810135316553</span></p>
<h2 id="8、垃圾收集器"><a href="#8、垃圾收集器" class="headerlink" title="8、垃圾收集器"></a>8、垃圾收集器</h2><blockquote>
<p><strong>怎么看服务器默认的垃圾收集器是哪个？生产上如何配置垃圾收集器？ 谈谈你对垃圾收集器的理解</strong></p>
</blockquote>
<h3 id="8-1、查看默认垃圾收集器"><a href="#8-1、查看默认垃圾收集器" class="headerlink" title="8.1、查看默认垃圾收集器"></a>8.1、查看默认垃圾收集器</h3><blockquote>
<p><strong>命令行指令：java -XX:+PrintCommandLineFlags -version</strong></p>
</blockquote>
<ul>
<li>-XX:+UseParallelGC：表示使用 UseParallelGC 垃圾收集器</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">C:\Users\Heygo\Desktop\Interview&gt;<span class="hljs-keyword">java </span>-XX:+PrintCommandLineFlags -version<br>-XX:InitialHeapSize=<span class="hljs-number">266620736</span> -XX:MaxHeapSize=<span class="hljs-number">4265931776</span> -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocatio<br>n -XX:+UseParallelGC<br><span class="hljs-keyword">java </span>version <span class="hljs-string">&quot;1.8.0_144&quot;</span><br><span class="hljs-keyword">Java(TM) </span>SE Runtime Environment (<span class="hljs-keyword">build </span><span class="hljs-number">1</span>.<span class="hljs-number">8</span>.<span class="hljs-number">0</span>_144-<span class="hljs-keyword">b01)</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Java </span>HotSpot(TM) <span class="hljs-number">64</span>-<span class="hljs-keyword">Bit </span>Server VM (<span class="hljs-keyword">build </span><span class="hljs-number">25</span>.<span class="hljs-number">144</span>-<span class="hljs-keyword">b01, </span>mixed mode)<br><span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>

<h3 id="8-2、默认的垃圾收集器"><a href="#8-2、默认的垃圾收集器" class="headerlink" title="8.2、默认的垃圾收集器"></a>8.2、默认的垃圾收集器</h3><ol>
<li>Java的GC回收的类型主要有几种：UseSerialGC，UseParallelGC，UseConcMarkSweepGC，UseParNewGC，UseParallelOldGC，UseG1GC</li>
<li>UseSerialOldGC被淘汰了</li>
</ol>
<hr>
<ul>
<li>撕个 OpenJDK 源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">bool Arguments::check_gc_consistency() &#123;<br>  bool status = <span class="hljs-keyword">true</span>;<br>  <span class="hljs-comment">// Ensure that the user has not selected conflicting sets</span><br>  <span class="hljs-comment">// of collectors. [Note: this check is merely a user convenience;</span><br>  <span class="hljs-comment">// collectors over-ride each other so that only a non-conflicting</span><br>  <span class="hljs-comment">// set is selected; however what the user gets is not what they</span><br>  <span class="hljs-comment">// may have expected from the combination they asked for. It&#x27;s</span><br>  <span class="hljs-comment">// better to reduce user confusion by not allowing them to</span><br>  <span class="hljs-comment">// select conflicting combinations.</span><br><br>  uint i = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (UseSerialGC)                       i++;<br>  <span class="hljs-keyword">if</span> (UseConcMarkSweepGC || UseParNewGC) i++;<br>  <span class="hljs-keyword">if</span> (UseParallelGC || UseParallelOldGC) i++;<br>  <span class="hljs-keyword">if</span> (UseG1GC)                           i++;<br>  <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">1</span>) &#123;<br>    jio_fprintf(defaultStream::error_stream(),<br>                <span class="hljs-string">&quot;Conflicting collector combinations in option list; &quot;</span><br>                <span class="hljs-string">&quot;please refer to the release notes for the combinations &quot;</span><br>                <span class="hljs-string">&quot;allowed\n&quot;</span>);<br><br>    status = <span class="hljs-keyword">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> status;<br>&#125;<br><span class="hljs-number">12345678910111213141516171819202122232425</span><br></code></pre></td></tr></table></figure>

<h3 id="8-3、垃圾收集器细讲"><a href="#8-3、垃圾收集器细讲" class="headerlink" title="8.3、垃圾收集器细讲"></a>8.3、垃圾收集器细讲</h3><blockquote>
<p><strong>垃圾收集器概述</strong></p>
</blockquote>
<p>垃圾收集器就来具体实现这些GC算法并实现内存回收。不同厂商、不同版本的虚拟机实现差别很大，HotSpot中包含的收集器如下图所示：</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165708173.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810141740924</span></p>
<p>垃圾收集器对应的组合关系</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165714152.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810142134483</span></p>
<h4 id="8-3-1、部分参数说明"><a href="#8-3-1、部分参数说明" class="headerlink" title="8.3.1、部分参数说明"></a>8.3.1、部分参数说明</h4><ol>
<li><strong>DefNew</strong>：Default New Generation</li>
<li><strong>Tenured</strong>：Old</li>
<li><strong>ParNew</strong>：Parallel New Generation</li>
<li><strong>PSYoungGen</strong>：Parallel Scavenge</li>
<li><strong>ParOldGen</strong>：Parallel Old Generation</li>
</ol>
<h4 id="8-3-2、Server-amp-Client"><a href="#8-3-2、Server-amp-Client" class="headerlink" title="8.3.2、Server &amp; Client"></a>8.3.2、Server &amp; Client</h4><ol>
<li>适用范围：只需要掌握Server模式即可，Client模式基本不会用</li>
<li>根据操作系统以及硬件区分 Client 和 Server：<ul>
<li>32位Window操作系统，不论硬件如何都默认使用Client的JVM模式</li>
<li>32位其它操作系统，2G内存同时有2个cpu以上用Server模式，低于该配置还是Client模式</li>
<li>64位only server模式</li>
</ul>
</li>
</ol>
<h4 id="8-3-3、新生代垃圾回收"><a href="#8-3-3、新生代垃圾回收" class="headerlink" title="8.3.3、新生代垃圾回收"></a>8.3.3、新生代垃圾回收</h4><blockquote>
<p><strong>串行GC（Serial）/（Serial Copying）</strong></p>
</blockquote>
<p><strong>串行收集器：Serial收集器</strong></p>
<ol>
<li>一句话：一个单线程的收集器，在进行垃圾收集时候，必须暂停其他所有的工作线程直到它集结束。</li>
<li>串行收集器是最古老，最稳定以及效率高的收集器，只使用一个线程去回收但其在进行垃圾收集过程中可能会产生较长的停顿（Stop-The-World状态）。</li>
<li>虽然在收集垃圾过程中需要暂停所有其他的工作线程，但是它简单高效，对于限定单个CPU环境来说，没有线程交互的开销可以获得最高的单线程垃圾收集效率，因此Serial垃圾收集器依然是java虚拟机运行在Client模式下默认的新生代垃圾收集器。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165722573.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810142858620</span></p>
<hr>
<p><strong>参数配置：</strong></p>
<ol>
<li>对应JVM参数是：-XX:+UseSerialGC</li>
<li>开启后会使用：Serial（Young区用）+Serial Old（Old区用）的收集器组合</li>
<li>表示：新生代、老年代都会使用串行回收收集器，新生代使用复制算法，老年代使用标记-整理算法</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:UseSerialGC</span><br>1<br></code></pre></td></tr></table></figure>

<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165730352-20201010165734716.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810143721514</span></p>
<blockquote>
<p><strong>并行GC（ParNew）</strong></p>
</blockquote>
<p><strong>ParNew（并行）收集器</strong></p>
<ol>
<li>一句话：使用多线程进行垃圾回收，在垃圾收集时，会Stop-the-World暂停其他所有的工作线程直到它收集结束。</li>
<li>ParNew收集器其实就是Serial收集器新生代的并行多线程版本，最常见的应用场景是配合老年代的CMS GC工作，其余的行为和Seria收集器完全一样，ParNew垃圾收集器在垃圾收集过程中同样也要暂停所有其他的工作线程。它是很多java虚拟机运行在Server模式下新生代的默认垃圾收集器。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165743860-20201010165754385.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810144009359</span></p>
<hr>
<p><strong>参数配置：</strong></p>
<ol>
<li>常用对应JVM参数：-XX:+UseParNewGC启用ParNew收集器，只影响新生代的收集，不影响老年代</li>
<li>开启上述参数后，会使用：ParNew（Young区用）+Serial Old的收集器组合，新生代使用复制算法，老年代采用标记-整理算法</li>
<li>但是，ParNew+Tenured这样的搭配，java8已经不再被推荐： <code>Java HotSpot（TM）64-Bit Server VM warning：Using the ParNew young collector with the Serial old collector is deprecated and will likely be removed in a future release</code></li>
<li>-XX:ParallelGCThreads 限制线程数量，默认开启和CPU数目相同的线程数</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParNewGC</span><br>1<br></code></pre></td></tr></table></figure>

<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010164801548.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810144914274</span></p>
<blockquote>
<p><strong>并行回收GC（Parallel）/（Parallel Scavenge）</strong></p>
</blockquote>
<p><strong>Parallel 并行回收</strong></p>
<ol>
<li>Parallel Scavenge收集器类似ParNew也是一个新生代垃圾收集器，使用复制算法，也是一个并行的多线程的垃圾收集器，俗称吞吐量优先收集器。一句话：串行收集器在新生代和老年代的并行化</li>
<li>它重点关注的是：可控制的吞吐量（Thoughput=运行用户代码时间/(运行用户代码时间+垃圾收集时间)，也即比如程序运行100分钟，垃圾收集时间1分钟，吞吐量就是99%）。高吞吐量意味着高效利用CPU的时间，它多用于在后台运算而不需要太多交互的任务。</li>
<li>自适应调节策略也是ParallelScavenge 收集器与ParNew收集器的一个重要区别。（自适应调节策略：虚拟机会根据当前系统的运行情况收集性能监控信息，动态调整这些参数以提供最<strong>合适的停顿时间</strong>（-XX:MaxGCPauseMilis）或最大的吞吐量。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010164801548.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810145610076</span></p>
<hr>
<p><strong>参数配置：</strong></p>
<ol>
<li>常用JVM参数：-XX:+UseParallelGC或-XX:+UseParallelOldGC（可互相激活）使用Parallel Scanvenge收集器</li>
<li>开启该参数后：新生代使用复制算法，老年代使用标记-整理算法</li>
<li>多说一句：-XX:ParallelGCThreads=数字N表示启动多少个GC线程<ul>
<li>cpu&gt;8：N=5/8</li>
<li>cpu&lt;8：N=实际个数</li>
</ul>
</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelGC</span><br>或者<br><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelOldlGC</span><br>123<br></code></pre></td></tr></table></figure>

<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165820270.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810150156809</span></p>
<h4 id="8-3-4、老年代垃圾回收"><a href="#8-3-4、老年代垃圾回收" class="headerlink" title="8.3.4、老年代垃圾回收"></a>8.3.4、老年代垃圾回收</h4><blockquote>
<p><strong>串行GC（Serial Old）/（Serial MSC）</strong></p>
</blockquote>
<ol>
<li>Serial Old是 Serial垃圾收集器老年代版本，它同样是个单线程的收集器，使用标记-整理算法，这个收集器也主要是运行在Client默认的java虚拟机默认的年老代垃圾收集器。</li>
<li>在Server模式下，主要有两个用途（了解）：<ul>
<li>在JDK1.5之前版本中与新生代的Parallel Scavenge 收集器搭配使用。即垃圾收集器组合为：Parallel Scavenge+Serial Old</li>
<li>在JDK1.5之后作为老年代版中使用CMS收集器的后备垃圾收集方案。</li>
</ul>
</li>
</ol>
<hr>
<p><strong>参数配置：</strong></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseSerialOldlGC</span><br>1<br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>并行GC（Parallel Old）/（Parallel MSC）</strong></p>
</blockquote>
<ol>
<li>Parallel Old收集器是Parallel Scavenge的老年代版本，使用多线程的标记-整理算法，Parallel Old收集器在JDK1.6才开始提供。</li>
<li>在JDK1.6之前，新生代使用ParallelScavenge收集器只能搭配年老代的Serial Old收集器，只能保证新生代的吞吐量优先，无法保证整体的吞吐量。即在JDK1.6之前的垃圾回收器的搭配方案为Parallel Scavenge+Serial Old</li>
<li>Parallel Old正是为了在年老代同样提供吞吐量优先的垃圾收集器，如果系统对吞吐量要求比较高，JDK1.8后可以优先考虑新生代。Parallel Scavenge和年老代Parallel Old 收集器的搭配策略。在JDK1.8的垃圾回收器的搭配方案为Parallel Scavenge+Parallel Old</li>
</ol>
<hr>
<p><strong>参数配置：</strong></p>
<ol>
<li>JVM常用参数：-XX:+UseParallelOldGC 使用Parallel Old收集器</li>
<li>设置该参数后，新生代Parallel+老年代Parallel Old</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelOldlGC</span><br>或者<br><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelGC</span><br>123<br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>并发标记清除GC（CMS）</strong></p>
</blockquote>
<ol>
<li>CMS收集器（Concurrent Mark Sweep：并发标记清除）是一种以<strong>获取最短回收停顿时间</strong>为目标的收集器。</li>
<li>适合应用在互联网站或者B/S系统的服务器上，这类应用尤其重视服务器的响应速度，希望系统停顿时间最短。</li>
<li>CMS非常适合堆内存大、CPU核数多的服务器端应用，也是G1出现之前大型应用的首选收集器。</li>
<li>Concurrent Mark Sweep并发标记清除，并发收集低停顿，并发指的是与用户线程一起执行</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165832222.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810163913899</span></p>
<hr>
<p><strong>参数配置：</strong></p>
<ol>
<li>开启该收集器的JVM参数：-XX:+UseConcMarkSweepGC</li>
<li>开启该参数后会自动将-XX:+UseParNewGC打开开启该参数后，使用ParNew（Young区用）+CMS（Old区用）+Serial Old的收集器组合，Serial Old将作为CMS出错的后备收集器</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseConcMarkSweepGC </span><br>1<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>CMS 的 4 步过程</strong></p>
<ol>
<li><strong>初始标记</strong>（CMS initial mark）：只是<strong>标记一下GC Roots能直接关联的对象</strong>，速度很快，仍然需要暂停所有的工作线程。</li>
<li><strong>并发标记</strong>（CMS concurrent mark）和用户线程一起：进行GCRoots跟踪的过程，和用户线程一起工作，不需要暂停工作线程。主要标记过程，标记全部对象</li>
<li><strong>重新标记</strong>（CMS remark）：为了修正在并发标记期间，因用户程序继续运行而导致标记产生变动的那一部分对象的标记记录，仍然需要暂停所有的工作线程。由于并发标记时，用户线程依然运行，因此在正式清理前，再做修正</li>
<li><strong>并发清除</strong>（CMS concurrent sweep）和用户线程一起：清除GC Roots不可达对象，和用户线程一起工作，不需要暂停工作线程。基于标记结果，直接清理对象由于耗时最长的并发标记和并发清除过程中，垃圾收集线程可以和用户现在一起并发工作，所以总体上来看CMS收集器的内存回收和用户线程是一起并发地执行。</li>
</ol>
<hr>
<p>CMS 四步骤总结</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165838866.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810164820369</span></p>
<hr>
<p><strong>优点</strong></p>
<p>并发收集停顿时间低</p>
<hr>
<p><strong>缺点</strong></p>
<ol>
<li>并发执行，对CPU压力较大：由于并发进行，CMS在收集与应用线程会同时会增加对堆内存的占用，也就是说，CMS必须要在老年代堆内存用尽之前完成垃圾回收，否则CMS回收失败时，将触发担保机制，串行老年代收集器将会以STW的方式进行一次GC，从而造成较大停顿时间</li>
<li>采用的标记清除算法会产生大量碎片：标记清除算法无法整理空间碎片，老年代空间会随着应用时长被逐步耗尽，最后将不得不通过担保机制对堆内存进行压缩。CMS也提供了参数<code>-XX:CMSFulIGCsBeforeCompaction</code>（默认0，即每次都进行内存整理）来指定多少次CMS收集之后，进行一次压缩的Full GC。</li>
</ol>
<blockquote>
<p><strong>Demo 代码</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">1.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseSerialGC</span><br><span class="hljs-comment">2.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParNewGC</span><br><span class="hljs-comment">3.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelGC</span><br><span class="hljs-comment">4.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseParallelOldGC</span><br><span class="hljs-comment">5.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseConcMarkSweepGC</span><br><span class="hljs-comment">6.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseG1GC</span><br><span class="hljs-comment">7.-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseSerialOldGC (已经没有了)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GCDemo</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;GCDemo...&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            String str = <span class="hljs-string">&quot;bjtu&quot;</span>;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                str += str + <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">77777777</span>) + <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">88888888</span>);<br>                str.intern();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-number">123456789101112131415161718192021222324</span><br></code></pre></td></tr></table></figure>

<h3 id="8-4、如何选择垃圾收集器"><a href="#8-4、如何选择垃圾收集器" class="headerlink" title="8.4、如何选择垃圾收集器"></a>8.4、如何选择垃圾收集器</h3><p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165846003.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810170231217</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165851327.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810170359487</span></p>
<h2 id="9、G1-垃圾收集器"><a href="#9、G1-垃圾收集器" class="headerlink" title="9、G1 垃圾收集器"></a>9、G1 垃圾收集器</h2><h3 id="9-1、Before-G1"><a href="#9-1、Before-G1" class="headerlink" title="9.1、Before G1"></a>9.1、Before G1</h3><blockquote>
<p><strong>以前收集器特点</strong></p>
</blockquote>
<ol>
<li>年轻代和老年代是各自独立且连续的内存块</li>
<li>年轻代收集，使用单eden+S0+S1进行复制算法</li>
<li>老年代收集必须扫描整个老年代区域</li>
<li>都是以尽可能快速地执行GC为设计原则</li>
</ol>
<h3 id="9-2、G1-是什么"><a href="#9-2、G1-是什么" class="headerlink" title="9.2、G1 是什么"></a>9.2、G1 是什么</h3><p>G1（Garbage-First）收集器，是一款面向服务端应用的收集器</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165857887.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810181426666</span></p>
<hr>
<p>从官网的描述中，我们知道G1是一种服务器端的垃圾收集器，应用在多处理器和大容量内存环境中，在实现高吞吐量的同时，尽可能的满足垃圾收集暂停时间的要求。另外，它还具有以下特性：</p>
<ol>
<li>像CMS收集器一样，能与应用程序线程并发执行。</li>
<li>整理空闲空间更快。</li>
<li>需要更多的时间来预测GC停顿时间。</li>
<li>不希望牺牲大量的吞吐性能。</li>
<li>不需要更大的Java Heap。</li>
</ol>
<hr>
<p>G1收集器的设计目标是取代CMS收集器，它同CMS相比，在以下方面表现的更出色：</p>
<ol>
<li>G1是一个有整理内存过程的垃圾收集器，<strong>不会产生很多内存碎片</strong>。</li>
<li>G1的Stop The World（STW）更可控，G1在停顿时间上添加了预测机制，<strong>用户可以指定期望停顿时间</strong>。</li>
</ol>
<hr>
<p><strong>为什么会出现 G1？</strong></p>
<ol>
<li>CMS垃圾收集器虽然减少了暂停应用程序的运行时间，但是它还是存在着<strong>内存碎片</strong>问题。于是，为了去除内存碎片问题，同时又保留CMS垃圾收集器低暂停时间的优点，JAVA7发布了一个新的垃圾收集器——G1垃圾收集器。</li>
<li>G1是在2012年才在jdk1.7u4中可用。oracle官方计划在jdk9中将G1变成默认的垃圾收集器以替代CMS。它是一款面向服务端应用的收集器，主要应用在多CPU和大内存服务器环境下，极大的减少垃圾收集的停顿时间，全面提升服务器的性能，逐步替换java8以前的CMS收</li>
<li>主要改变是Eden，Survivor和Tenured等内存区域不再是连续的了，而是变成了<strong>一个个大小一样的region</strong>，每个region从1M到32M不等。一个region有可能属于Eden，Survivor或者Tenured内存区域。</li>
</ol>
<h3 id="9-3、G1-特点"><a href="#9-3、G1-特点" class="headerlink" title="9.3、G1 特点"></a>9.3、G1 特点</h3><ol>
<li>G1能充分利用多CPU、多核环境硬件优势，尽量缩短STW。</li>
<li>G1<strong>整体上采用标记-整理算法</strong>，<strong>局部是通过复制算法</strong>，不会产生内存碎片。</li>
<li>宏观上看G1之中不再区分年轻代和老年代。把内存划分成多个独立的子区域（Region），可以近似理解为一个围棋的棋盘。</li>
<li>G1收集器里面讲整个的内存区都混合在一起了，但其本身依然在小范围内要进行年轻代和老年代的区分，保留了新生代和老年代，但它们不再是物理隔离的，而是一部分Region的集合且不需要Region是连续的，也就是说依然会采用不同的GC方式来处理不同的区域。</li>
<li>G1虽然也是分代收集器，但整个内存分区不存在物理上的年轻代与老年代的区别，也不需要完全独立的survivor（to space）堆做复制准备。G1只有逻辑上的分代概念，或者说<strong>每个分区都可能随G1的运行在不同代之间前后切换</strong>。</li>
</ol>
<h3 id="9-4、G1-底层原理"><a href="#9-4、G1-底层原理" class="headerlink" title="9.4、G1 底层原理"></a>9.4、G1 底层原理</h3><blockquote>
<p><strong>Region区域化垃圾收集器：最大的好处是化整为零，避免全内存扫描，只需要按区域来进行扫描即可</strong></p>
</blockquote>
<ol>
<li>区域化内存划片Region，整体编为了一些列不连续的内存区域，避免了全内存区的GC操作。</li>
<li>核心思想是将整个堆内存区域分成大小相同的子区域（Region），在JVM启动时会自动设置这些子区域的大小。</li>
<li>在堆的使用上，G1并不要求对象的存储一定是物理上连续的，只要<strong>逻辑上连续</strong>即可，<strong>每个分区也不会固定地为某个代服务，可以按需在年轻代和老年代之间切换</strong>。</li>
<li>启动时可以通过参数-XX:G1HeapRegionSize=n可指定分区大小（1MB~32MB，且必须是2的幂），默认将整堆划分为2048个分区。</li>
<li>每个Region 小范围在1MB~32MB，最多能设置2048个区域，也即能够支持的最大内存为：32MB*2048=65536MB=64G内存</li>
</ol>
<blockquote>
<p><strong>G1算法将堆划分为若干个区域（Region），它仍然属于分代收集器</strong></p>
</blockquote>
<ol>
<li>这些Region的一部分包含新生代，新生代的垃圾收集依然采用暂停所有应用线程的方式，将存活对象拷贝到老年代或者Survivor空间。</li>
<li>这些Region的一部分包含老年代，<strong>G1收集器通过将对象从一个区域复制到另外一个区域，完成了清理工作</strong>。这就意味着，在正常的处理过程中，G1完成了堆的压缩（至少是部分堆的压缩），这样也就不会有CMS内存碎片问题的存在了。</li>
</ol>
<blockquote>
<p><strong>在G1中，还有一种特殊的区域，叫Humongous（巨大的）区域</strong></p>
</blockquote>
<ol>
<li>如果一个对象占用的空间超过了分区容量50%以上，G1收集器就认为这是一个巨型对象。这些巨型对象默认直接会被分配在年老代，但是如果它是一个短期存在的巨型对象，就会对垃圾收集器造成负面影响。</li>
<li>为了解决这个问题，G1划分了一个Humongous区，它用来专门存放巨型对象。如果一个H区装不下一个巨型对象，那么G1会寻找连续的H分区来存储。为了能找到连续的H区，有时候不得不启动Full GC。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165907471.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810182928458</span></p>
<blockquote>
<p><strong>G1 回收步骤</strong></p>
</blockquote>
<p>G1收集器下的Young GC针对Eden区进行收集，Eden区耗尽后会被触发，主要是小区域收集+形成连续的内存块，避免内存碎片</p>
<ol>
<li>Eden区的数据移动到Survivor区，假如出现Survivor区空间不够，Eden区数据会部会晋升到Old区</li>
<li>Survivor区的数据移动到新的Survivor区，部会数据晋升到Old区</li>
<li>最后Eden区收拾干净了，GC结束，用户的应用程序继续执行。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165913899.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810183550459</span></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165919288.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810183646568</span></p>
<blockquote>
<p><strong>G1 工作的四大步骤</strong></p>
</blockquote>
<ol>
<li><strong>初始标记</strong>：只标记GC Roots能直接关联到的对象</li>
<li><strong>并发标记</strong>：进行GC Roots Tracing的过程</li>
<li><strong>最终标记</strong>：修正并发标记期间，因程序运行导致标记发生变化的那一部分对象</li>
<li><strong>筛选回收</strong>：根据时间来进行价值最大化的回收</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165924433.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810183927993</span></p>
<blockquote>
<p><strong>G1 Demo 代码</strong></p>
</blockquote>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span> GCDemo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> Heygo</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020/8/10 18:40</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GCDemo</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;GCDemo...&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            String str = <span class="hljs-string">&quot;bjtu&quot;</span>;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                str += str + <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">77777777</span>) + <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">88888888</span>);<br>                str.intern();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-number">12345678910111213141516171819202122</span><br></code></pre></td></tr></table></figure>

<ul>
<li>JVM 参数</li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms10m -Xmx10m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -XX:+UseG1GC</span><br>1<br></code></pre></td></tr></table></figure>

<ul>
<li>程序运行结果<ul>
<li>initial-mark：初始标记</li>
<li>GC concurrent-mark-start ：并发标记</li>
<li>GC remark：最终标记</li>
<li>GC cleanup：筛选回收</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs json">[GC pause (G1 Humongous Allocation) (young) (initial-mark) (to-space exhausted), <span class="hljs-number">0.0032657</span> secs]<br>   [Parallel Time: <span class="hljs-number">1.8</span> ms, GC Workers: <span class="hljs-number">8</span>]<br>      [GC Worker Start (ms): Min: <span class="hljs-number">116.9</span>, Avg: <span class="hljs-number">117.0</span>, Max: <span class="hljs-number">117.2</span>, Diff: <span class="hljs-number">0.2</span>]<br>      [Ext Root Scanning (ms): Min: <span class="hljs-number">0.1</span>, Avg: <span class="hljs-number">0.3</span>, Max: <span class="hljs-number">0.6</span>, Diff: <span class="hljs-number">0.5</span>, Sum: <span class="hljs-number">2.4</span>]<br>      [Update RS (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.1</span>, Max: <span class="hljs-number">0.2</span>, Diff: <span class="hljs-number">0.2</span>, Sum: <span class="hljs-number">0.8</span>]<br>         [Processed Buffers: Min: <span class="hljs-number">0</span>, Avg: <span class="hljs-number">1.9</span>, Max: <span class="hljs-number">4</span>, Diff: <span class="hljs-number">4</span>, Sum: <span class="hljs-number">15</span>]<br>      [Scan RS (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.0</span>, Diff: <span class="hljs-number">0.0</span>, Sum: <span class="hljs-number">0.0</span>]<br>      [Code Root Scanning (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.0</span>, Diff: <span class="hljs-number">0.0</span>, Sum: <span class="hljs-number">0.0</span>]<br>      [Object Copy (ms): Min: <span class="hljs-number">1.0</span>, Avg: <span class="hljs-number">1.2</span>, Max: <span class="hljs-number">1.3</span>, Diff: <span class="hljs-number">0.3</span>, Sum: <span class="hljs-number">9.8</span>]<br>      [Termination (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.1</span>, Diff: <span class="hljs-number">0.1</span>, Sum: <span class="hljs-number">0.4</span>]<br>         [Termination Attempts: Min: <span class="hljs-number">1</span>, Avg: <span class="hljs-number">6.9</span>, Max: <span class="hljs-number">14</span>, Diff: <span class="hljs-number">13</span>, Sum: <span class="hljs-number">55</span>]<br>      [GC Worker Other (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.0</span>, Diff: <span class="hljs-number">0.0</span>, Sum: <span class="hljs-number">0.2</span>]<br>      [GC Worker Total (ms): Min: <span class="hljs-number">1.5</span>, Avg: <span class="hljs-number">1.7</span>, Max: <span class="hljs-number">1.8</span>, Diff: <span class="hljs-number">0.2</span>, Sum: <span class="hljs-number">13.5</span>]<br>      [GC Worker End (ms): Min: <span class="hljs-number">118.7</span>, Avg: <span class="hljs-number">118.7</span>, Max: <span class="hljs-number">118.7</span>, Diff: <span class="hljs-number">0.0</span>]<br>   [Code Root Fixup: <span class="hljs-number">0.0</span> ms]<br>   [Code Root Purge: <span class="hljs-number">0.0</span> ms]<br>   [Clear CT: <span class="hljs-number">0.2</span> ms]<br>   [Other: <span class="hljs-number">1.3</span> ms]<br>      [Evacuation Failure: <span class="hljs-number">0.9</span> ms]<br>      [Choose CSet: <span class="hljs-number">0.0</span> ms]<br>      [Ref Proc: <span class="hljs-number">0.3</span> ms]<br>      [Ref Enq: <span class="hljs-number">0.0</span> ms]<br>      [Redirty Cards: <span class="hljs-number">0.1</span> ms]<br>      [Humongous Register: <span class="hljs-number">0.0</span> ms]<br>      [Humongous Reclaim: <span class="hljs-number">0.0</span> ms]<br>      [Free CSet: <span class="hljs-number">0.0</span> ms]<br>   [Eden: <span class="hljs-number">5120.0</span>K(<span class="hljs-number">6144.0</span>K)-&gt;<span class="hljs-number">0.0</span>B(<span class="hljs-number">1024.0</span>K) Survivors: <span class="hljs-number">0.0</span>B-&gt;<span class="hljs-number">1024.0</span>K Heap: <span class="hljs-number">7351.7</span>K(<span class="hljs-number">10.0</span>M)-&gt;<span class="hljs-number">6167.8</span>K(<span class="hljs-number">10.0</span>M)]<br> [Times: user=<span class="hljs-number">0.09</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC concurrent-root-region-scan-start]<br>[GC concurrent-root-region-scan-end, <span class="hljs-number">0.0009353</span> secs]<br>[GC concurrent-mark-start]<br>[GC pause (G1 Humongous Allocation) (young) (to-space exhausted), <span class="hljs-number">0.0037669</span> secs]<br>   [Parallel Time: <span class="hljs-number">2.7</span> ms, GC Workers: <span class="hljs-number">8</span>]<br>      [GC Worker Start (ms): Min: <span class="hljs-number">122.1</span>, Avg: <span class="hljs-number">122.1</span>, Max: <span class="hljs-number">122.2</span>, Diff: <span class="hljs-number">0.1</span>]<br>      [Ext Root Scanning (ms): Min: <span class="hljs-number">0.1</span>, Avg: <span class="hljs-number">0.4</span>, Max: <span class="hljs-number">2.6</span>, Diff: <span class="hljs-number">2.5</span>, Sum: <span class="hljs-number">3.3</span>]<br>      [Update RS (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.1</span>, Diff: <span class="hljs-number">0.1</span>, Sum: <span class="hljs-number">0.1</span>]<br>         [Processed Buffers: Min: <span class="hljs-number">0</span>, Avg: <span class="hljs-number">0.4</span>, Max: <span class="hljs-number">3</span>, Diff: <span class="hljs-number">3</span>, Sum: <span class="hljs-number">3</span>]<br>      [Scan RS (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.0</span>, Diff: <span class="hljs-number">0.0</span>, Sum: <span class="hljs-number">0.0</span>]<br>      [Code Root Scanning (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.2</span>, Diff: <span class="hljs-number">0.2</span>, Sum: <span class="hljs-number">0.2</span>]<br>      [Object Copy (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">1.1</span>, Max: <span class="hljs-number">1.5</span>, Diff: <span class="hljs-number">1.5</span>, Sum: <span class="hljs-number">9.0</span>]<br>      [Termination (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">1.0</span>, Max: <span class="hljs-number">1.3</span>, Diff: <span class="hljs-number">1.3</span>, Sum: <span class="hljs-number">7.9</span>]<br>         [Termination Attempts: Min: <span class="hljs-number">1</span>, Avg: <span class="hljs-number">1.0</span>, Max: <span class="hljs-number">1</span>, Diff: <span class="hljs-number">0</span>, Sum: <span class="hljs-number">8</span>]<br>      [GC Worker Other (ms): Min: <span class="hljs-number">0.0</span>, Avg: <span class="hljs-number">0.0</span>, Max: <span class="hljs-number">0.0</span>, Diff: <span class="hljs-number">0.0</span>, Sum: <span class="hljs-number">0.1</span>]<br>      [GC Worker Total (ms): Min: <span class="hljs-number">2.5</span>, Avg: <span class="hljs-number">2.6</span>, Max: <span class="hljs-number">2.6</span>, Diff: <span class="hljs-number">0.1</span>, Sum: <span class="hljs-number">20.6</span>]<br>      [GC Worker End (ms): Min: <span class="hljs-number">124.7</span>, Avg: <span class="hljs-number">124.7</span>, Max: <span class="hljs-number">124.7</span>, Diff: <span class="hljs-number">0.0</span>]<br>   [Code Root Fixup: <span class="hljs-number">0.0</span> ms]<br>   [Code Root Purge: <span class="hljs-number">0.0</span> ms]<br>   [Clear CT: <span class="hljs-number">0.1</span> ms]<br>   [Other: <span class="hljs-number">0.9</span> ms]<br>      [Evacuation Failure: <span class="hljs-number">0.5</span> ms]<br>      [Choose CSet: <span class="hljs-number">0.0</span> ms]<br>      [Ref Proc: <span class="hljs-number">0.2</span> ms]<br>      [Ref Enq: <span class="hljs-number">0.0</span> ms]<br>      [Redirty Cards: <span class="hljs-number">0.1</span> ms]<br>      [Humongous Register: <span class="hljs-number">0.0</span> ms]<br>      [Humongous Reclaim: <span class="hljs-number">0.0</span> ms]<br>      [Free CSet: <span class="hljs-number">0.0</span> ms]<br>   [Eden: <span class="hljs-number">1024.0</span>K(<span class="hljs-number">1024.0</span>K)-&gt;<span class="hljs-number">0.0</span>B(<span class="hljs-number">1024.0</span>K) Survivors: <span class="hljs-number">1024.0</span>K-&gt;<span class="hljs-number">0.0</span>B Heap: <span class="hljs-number">7372.3</span>K(<span class="hljs-number">10.0</span>M)-&gt;<span class="hljs-number">6188.4</span>K(<span class="hljs-number">10.0</span>M)]<br> [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC concurrent-mark-end, <span class="hljs-number">0.0043902</span> secs]<br>[GC remark [Finalize Marking, <span class="hljs-number">0.0001364</span> secs] [GC ref-proc, <span class="hljs-number">0.0002039</span> secs] [Unloading, <span class="hljs-number">0.0004323</span> secs], <span class="hljs-number">0.0008988</span> secs]<br> [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC cleanup <span class="hljs-number">7372</span>K-&gt;<span class="hljs-number">7372</span>K(<span class="hljs-number">10</span>M), <span class="hljs-number">0.0005463</span> secs]<br> [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br><span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364</span><br></code></pre></td></tr></table></figure>

<ul>
<li>G1 中堆分为两部分：garbage-first heap 和 Metaspace（Non-heap）</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">Heap<br> garbage-first heap   total <span class="hljs-number">10240</span>K, used <span class="hljs-number">4199</span>K [<span class="hljs-number">0x00000000ff600000</span>, <span class="hljs-number">0x00000000ff700050</span>, <span class="hljs-number">0x0000000100000000</span>)<br>  region size <span class="hljs-number">1024</span>K, <span class="hljs-number">1</span> young (<span class="hljs-number">1024</span>K), <span class="hljs-number">0</span> survivors (<span class="hljs-number">0</span>K)<br> Metaspace       used <span class="hljs-number">3510</span>K, capacity <span class="hljs-number">4496</span>K, committed <span class="hljs-number">4864</span>K, reserved <span class="hljs-number">1056768</span>K<br>  <span class="hljs-keyword">class</span> <span class="hljs-symbol">space</span>    <span class="hljs-symbol">used</span> <span class="hljs-symbol">384K, <span class="hljs-symbol">capacity</span></span> <span class="hljs-symbol">388K, <span class="hljs-symbol">committed</span></span> <span class="hljs-symbol">512K, <span class="hljs-symbol">reserved</span></span> <span class="hljs-symbol">1048576K</span><br><span class="hljs-symbol">12345</span><br></code></pre></td></tr></table></figure>

<h3 id="9-5、G1-常用参数"><a href="#9-5、G1-常用参数" class="headerlink" title="9.5、G1 常用参数"></a>9.5、G1 常用参数</h3><blockquote>
<p><strong>常用配置参数（了解）</strong></p>
</blockquote>
<ol>
<li>-XX:+UseG1GC</li>
<li>-XX:G1HeapRegionSize=n：设置G1区域的大小。值是2的幂，范围是1M到32M。目标是根据最小的Java堆大小划分出约2048个区域</li>
<li>-XX:MaxGCPauseMillis=n：最大停顿时间，这是个软目标，JVM将尽可能（但不保证）停顿时间小于这个时间</li>
<li>-XX:InitiatingHeapOccupancyPercent=n：堆占用了百分之多少的时候就触发GC，默认是45</li>
<li>-XX:ConcGCThreads=n：并发GC使用的线程数</li>
<li>-XX:G1ReservePercent=n：设置作为空闲空间的预留内存百分比，以降低目标空间溢出的风险，默认值是10%</li>
</ol>
<hr>
<p><strong>G1 常用配置：</strong></p>
<ol>
<li><p>开发人员仅仅需要声明以下参数即可：</p>
</li>
<li><p>三步归纳：开始G1+设置最大内存+设置最大停顿时间</p>
<p>-XX:MaxGCPauseMilis=n：最大GC停顿时间，单位毫秒，这是个软目标，JVM将尽可能（但不保证）停顿小于这个时间</p>
</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-XX:+UseG1GC -Xmx32g -XX:<span class="hljs-attribute">MaxGCPauseMillis</span>=100<br>1<br></code></pre></td></tr></table></figure>

<h3 id="9-6、G1-的优势"><a href="#9-6、G1-的优势" class="headerlink" title="9.6、G1 的优势"></a>9.6、G1 的优势</h3><blockquote>
<p><strong>G1 相较于 CMS 的优势</strong></p>
</blockquote>
<p>比起CMS有两个优势：</p>
<ol>
<li><strong>G1不会产生内存碎片</strong></li>
<li><strong>可以精确控制停顿</strong>。该收集器把整个堆（新生代、老生代）划分为多个固定大小的区域，每次根据允许停顿的时间去收集垃圾最多的区域。</li>
</ol>
<h2 id="10、生产调优"><a href="#10、生产调优" class="headerlink" title="10、生产调优"></a>10、生产调优</h2><h3 id="10-1、SpringBoot-调优步骤"><a href="#10-1、SpringBoot-调优步骤" class="headerlink" title="10.1、SpringBoot 调优步骤"></a>10.1、SpringBoot 调优步骤</h3><blockquote>
<p><strong>SpringBoot 微服务的生产部署和调参优化步骤</strong></p>
</blockquote>
<ol>
<li>IDEA开发完微服务工程</li>
<li>maven进行clean + package</li>
<li>要求微服务启动的时候，同时配置我们的JVM/GC的调优参数</li>
<li>公式：java -server jvm的各种参数 -jar jar/war包名字</li>
</ol>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span> -server -Xms<span class="hljs-number">1024</span>m -Xmx<span class="hljs-number">1024</span>m -XX+UseG<span class="hljs-number">1</span>GC -jar springboot<span class="hljs-number">2019</span>-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-SNAPSHOT.war<br><span class="hljs-attribute">1</span><br></code></pre></td></tr></table></figure>

<h3 id="10-2、调优思路和性能评估"><a href="#10-2、调优思路和性能评估" class="headerlink" title="10.2、调优思路和性能评估"></a>10.2、调优思路和性能评估</h3><blockquote>
<p><strong>整机：top（查看 CPU、内存使用率等，也可使用精简版系统性能命令：uptime）</strong></p>
</blockquote>
<ul>
<li>主要查看 CPU、MEM、load average（按 1 可详细查看 CPU 的每个核心状态）</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165936274.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200810224133559</span></p>
<blockquote>
<p><strong>CPU：vmstat（查看 CPU 使用情况）</strong></p>
</blockquote>
<p><strong>vmstat -n 2 3</strong></p>
<ul>
<li>一般vmstat工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数单位是秒，第二个参数是采样的次数</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165944103.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811103909264</span></p>
<hr>
<p><strong>参数含义</strong></p>
<ol>
<li>-procs<ul>
<li>r：运行和等待CPU时间片的进程数，原则上1核的CPU的运行队列不要超过2，整个系统的运行队列不能超过总核数的2倍，否则代表系统压力过大</li>
<li>b：等待资源的进程数，比如正在等待磁盘I/O、网络I/O等</li>
</ul>
</li>
<li>-cpu<ul>
<li>us：用户进程消耗CPU时间百分比，us值高，用户进程消耗CPU时间多，如果长期大于50%，需要优化程序</li>
<li>sy：内核进程消耗的CPU时间百分比</li>
<li>说明：us +sy参考值为80%，如果us+sy大于80%，说明可能存在CPU不足</li>
<li>id：处于空闲的CPU百分比</li>
<li>wa：系统等待IO的CPU时间百分比</li>
<li>st：来自于一个虚拟机偷取的CPU时间的百分比</li>
</ul>
</li>
</ol>
<hr>
<p><strong>其他的查看指令</strong></p>
<ol>
<li><p>查看所有cpu核信息：mpstat -P ALL 2 （每两秒采样一次）</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165950811.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811104022295</span></p>
</li>
<li><p>每个进程使用cpu的用量分解信息：pidstat -u 1 -p 进程编号</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010165956167.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811104127566</span></p>
</li>
</ol>
<blockquote>
<p><strong>内存：free（查看应用程序可用内存数）</strong></p>
</blockquote>
<ol>
<li>free：以字节为单位</li>
<li>free -g：以 GB 为单位</li>
<li>free -m：以 GB 为单位</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170001554.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811104315525</span></p>
<hr>
<p><strong>经验值</strong></p>
<ol>
<li>应用程序可用内存/系统物理内存&gt;70%内存充足</li>
<li>应用程序可用内存/系统物理内存&lt;20%内存不足，需要增加内存</li>
<li>20%&lt;应用程序可用内存/系统物理内存&lt;70%内存基本够用</li>
</ol>
<hr>
<p><strong>pidstat -p 进程号 -r 采样间隔秒数，可查看进程占用内存的情况</strong></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170008022.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811104852689</span></p>
<blockquote>
<p><strong>硬盘：df（查看磁盘剩余空间数）</strong></p>
</blockquote>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170013828.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811105021832</span></p>
<blockquote>
<p><strong>磁盘io：iostat（磁盘IO性能评估）</strong></p>
</blockquote>
<p>磁盘块设备分布</p>
<ol>
<li>rkB/s每秒读取数据量kB</li>
<li>wkB/s每秒写入数据量kB</li>
<li>svctm I/O请求的平均服务时间，单位毫秒</li>
<li>await I/O请求的平均等待时间，单位毫秒；值越小，性能越好</li>
<li>util一秒中有百分几的时间用于I/O操作。接近100%时，表示磁盘带宽跑满，需要优化程序或者增加磁盘</li>
<li>rkB/s、wkB/s根据系统应用不同会有不同的值，但有规律遵循：长期、超大数据读写，肯定不正常，需要优化程序读取。</li>
<li>svctm的值与await的值很接近，表示几乎没有/O等待，磁盘性能好，如果await的值远高于svctm的值，则表示I/O队列等待太长，需要优化程序或更换更快磁盘。</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170020118.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811105246814</span></p>
<hr>
<p><strong>pidstat -p 进程号 -r 采样间隔秒数，可查看进程磁盘的使用情况</strong></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170029259.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811105459180</span></p>
<blockquote>
<p><strong>网络io：ifstat（查看网络占用情况）</strong></p>
</blockquote>
<p><strong>默认本地没有，下载ifstat</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://gael.roualland.free.fr/ifstat/ifstat-1.1.tar.gz<br><br>tar xzvf ifstat-1.1.tar.gz <br><br><span class="hljs-built_in">cd</span> ifstat-1.1<br><br>./configure<br><br>make <br><br>make install<br>1234567891011<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>查看网络 I/O 情况</strong></p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170035109.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811105807765</span></p>
<h2 id="11、CPU-占用率高"><a href="#11、CPU-占用率高" class="headerlink" title="11、CPU 占用率高"></a>11、CPU 占用率高</h2><blockquote>
<p><strong>假如生产环境出现CPU占用过高，请谈谈你的分析思路和定位</strong></p>
</blockquote>
<p>下面开始举例啦~~~</p>
<blockquote>
<p><strong>先用top命令找出cpu占比最高的，记下PID</strong></p>
</blockquote>
<ul>
<li>第一个是控制台输出，不用管它，第二个才是我们要监控的进程（CPU 占用率高）</li>
</ul>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170041169.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811110244599</span></p>
<blockquote>
<p><strong>ps -ef或者jps进一步定位，得知是一个怎么样的一个后台程序</strong></p>
</blockquote>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170047212.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811110422503</span></p>
<blockquote>
<p><strong>定位到具体的线程或代码</strong></p>
</blockquote>
<p><strong>ps -mp 进程编号 -o THREAD,tid,time</strong></p>
<ol>
<li>-m：显示所有的线程</li>
<li>-p：pid进程使用cpu的时间</li>
<li>-o：该参数后是用户自定义的格式</li>
</ol>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170052773.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811111345646</span></p>
<blockquote>
<p><strong>将需要的线程ID转换为16进制格式（英文小写格式）</strong></p>
</blockquote>
<p>printf “%x\n”：打印输出有问题的线程ID（用计算器算也可以）</p>
<blockquote>
<p><strong>jstack 进程ID | grep tid（16进制线程ID小写英文）-A60</strong></p>
</blockquote>
<p>-A60 表示打印出前 60 行</p>
<p><img    class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170100199.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image-20200811111915794</span></p>
<h2 id="12、JVM-分析工具"><a href="#12、JVM-分析工具" class="headerlink" title="12、JVM 分析工具"></a>12、JVM 分析工具</h2><blockquote>
<p><strong>对于JDK自带的JVM监控和性能分析工具用过哪些？一般怎么使用</strong></p>
</blockquote>
<p>下面开讲</p>
<blockquote>
<p><strong>自带的JVM监控和性能分析工具是什么</strong></p>
</blockquote>
<ul>
<li>官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/">https://docs.oracle.com/javase/8/docs/technotes/tools/</a></li>
</ul>
<p><img   class="lazyload" data-original="http://xmt.ssluxury.cn/format,png-20201010170100199-20201010170107254.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<blockquote>
<p><strong>自带的JVM监控和性能分析工具怎么用？</strong></p>
</blockquote>
<ol>
<li>jps（虚拟机进程状况工具）</li>
<li>jinfo（java配置信息工具）</li>
<li>jmap（内存映像工具）</li>
<li>jstat（统计信息监视工具）</li>
<li>jstack（堆栈异常跟踪工具）</li>
<li>jvisualvm</li>
<li>jconsole</li>
</ol>
      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>Xu Fei</li>
    <li><strong>本文链接：</strong><a href="https://longshenzhifeijue.github.io/2019/05/05/JVM%E9%9D%A2%E8%AF%95/index.html" title="https:&#x2F;&#x2F;longshenzhifeijue.github.io&#x2F;2019&#x2F;05&#x2F;05&#x2F;JVM%E9%9D%A2%E8%AF%95&#x2F;index.html">https:&#x2F;&#x2F;longshenzhifeijue.github.io&#x2F;2019&#x2F;05&#x2F;05&#x2F;JVM%E9%9D%A2%E8%AF%95&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul> 

        
  <nav class="nav">
    <a href="/2020/06/18/linux%20centos7%20%E5%AE%89%E8%A3%85mysql-5.7.17%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%BE%E8%A7%A3%EF%BC%89/"><i class="iconfont iconleft"></i>linux centos7 安装mysql-5.7.17教程（图解）</a>
    <a></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81JVM-%E5%A4%8D%E4%B9%A0%E4%B8%B2%E8%AE%B2"><span class="toc-text">1、JVM 复习串讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%B0%88%E8%B0%88-GC-Roots"><span class="toc-text">2、谈谈 GC Roots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81JVM-%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">3、JVM 系统默认值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81JVM%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text">3.1、JVM参数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81%E6%9F%A5%E7%9C%8B-JVM-%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">3.2、查看 JVM 默认值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81JVM-%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-text">4、JVM 常用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%9B%9B%E4%B8%AD%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-text">5、四中引用类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-text">5.1、整体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8"><span class="toc-text">5.2、四种引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E3%80%81%E5%BC%95%E7%94%A8%E6%80%BB%E7%BB%93"><span class="toc-text">5.3、引用总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81OOM"><span class="toc-text">6、OOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81GC-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-text">7、GC 垃圾回收</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">8、垃圾收集器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1%E3%80%81%E6%9F%A5%E7%9C%8B%E9%BB%98%E8%AE%A4%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">8.1、查看默认垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2%E3%80%81%E9%BB%98%E8%AE%A4%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">8.2、默认的垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3%E3%80%81%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%BB%86%E8%AE%B2"><span class="toc-text">8.3、垃圾收集器细讲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4%E3%80%81%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">8.4、如何选择垃圾收集器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81G1-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">9、G1 垃圾收集器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1%E3%80%81Before-G1"><span class="toc-text">9.1、Before G1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2%E3%80%81G1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">9.2、G1 是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3%E3%80%81G1-%E7%89%B9%E7%82%B9"><span class="toc-text">9.3、G1 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4%E3%80%81G1-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-text">9.4、G1 底层原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5%E3%80%81G1-%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-text">9.5、G1 常用参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6%E3%80%81G1-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text">9.6、G1 的优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E7%94%9F%E4%BA%A7%E8%B0%83%E4%BC%98"><span class="toc-text">10、生产调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1%E3%80%81SpringBoot-%E8%B0%83%E4%BC%98%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.1、SpringBoot 调优步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2%E3%80%81%E8%B0%83%E4%BC%98%E6%80%9D%E8%B7%AF%E5%92%8C%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0"><span class="toc-text">10.2、调优思路和性能评估</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81CPU-%E5%8D%A0%E7%94%A8%E7%8E%87%E9%AB%98"><span class="toc-text">11、CPU 占用率高</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81JVM-%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-text">12、JVM 分析工具</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/longshenzhifeijue "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:xufei20160601@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/longshenzhifeijue">XuFei</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>